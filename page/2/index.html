<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">






















<link rel="stylesheet" href="/memory/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">

<link rel="stylesheet" href="/memory/css/main.css?v=7.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/memory/images/apple-touch-icon-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/memory/images/favicon-32x32-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/memory/images/favicon-16x16-next.png?v=7.2.0">


  <link rel="mask-icon" href="/memory/images/logo.svg?v=7.2.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/memory/',
    scheme: 'Muse',
    version: '7.2.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="遇到好玩的，稀奇的，新鲜的，记录下来，分享出去。">
<meta name="keywords" content="博客 分享">
<meta property="og:type" content="website">
<meta property="og:title" content="fox的博客">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="fox的博客">
<meta property="og:description" content="遇到好玩的，稀奇的，新鲜的，记录下来，分享出去。">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="fox的博客">
<meta name="twitter:description" content="遇到好玩的，稀奇的，新鲜的，记录下来，分享出去。">





  
  
  <link rel="canonical" href="http://yoursite.com/page/2/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>fox的博客</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/memory/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">fox的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">github地址 -> https://github.com/FoxDaxian</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
      
    

    

    <a href="/memory/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
      
    

    

    <a href="/memory/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/memory/2021/05/09/electron/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FoxDaxian">
      <meta itemprop="description" content="遇到好玩的，稀奇的，新鲜的，记录下来，分享出去。">
      <meta itemprop="image" content="/memory/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fox的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/memory/2021/05/09/electron/" class="post-title-link" itemprop="url">electron简析</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2021-05-09 23:37:00" itemprop="dateCreated datePublished" datetime="2021-05-09T23:37:00+00:00">2021-05-09</time>
            </span>
          

          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/memory/categories/原理/" itemprop="url" rel="index"><span itemprop="name">原理</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="什么是electron"><a href="#什么是electron" class="headerlink" title="什么是electron"></a>什么是electron</h3><p>electron是一个可以用HTML、CSS、JS来构建桌面应用的程序，并且具有跨平台型。</p>
<h3 id="electron的重要性"><a href="#electron的重要性" class="headerlink" title="electron的重要性"></a>electron的重要性</h3><p>一般来说，桌面应用在不同的系统上需要不同的原生语言。electron，可以让你的桌面应用兼容大多数流行平台。</p>
<h3 id="组成"><a href="#组成" class="headerlink" title="组成"></a>组成</h3><p>electron组合chromium和nodejs，并且为原生操作系统暴露出一些自定义的api，比如吊起文件dialog，通知栏，等等<br><img src="https://raw.githubusercontent.com/FoxDaxian/FoxDaxian.github.io/master/assets/12_electron/components.png" alt="alt"></p>
<h3 id="开发体验"><a href="#开发体验" class="headerlink" title="开发体验"></a>开发体验</h3><p>开发electron就像构建一个网页一样，你可以无缝使用nodejs。并且你不需要考虑兼容性。</p>
<h3 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h3><ul>
<li>主进程：package.json中的main对应的文件执行后是主进程</li>
<li>渲染进程：每个electron页面都运行着自己的进程，称为渲染进程</li>
</ul>
<h3 id="联系和区别"><a href="#联系和区别" class="headerlink" title="联系和区别"></a>联系和区别</h3><ul>
<li>主进程，一般来说是main.js。这是整个electron app的入口，控制着app的生命周期，从打开到关闭，控制着打开原生元素，和创建新的渲染进程。并且集成nodejs api</li>
</ul>
<p><img src="https://raw.githubusercontent.com/FoxDaxian/FoxDaxian.github.io/master/assets/12_electron/main.png" alt="alt"></p>
<ul>
<li>渲染进程：说白了渲染进程就是app的浏览器窗口，不像主进程，这可以有多个，并且相互独立。也可以被隐藏，一般来说命名为index.html，html中有着通用文件特性，但有一点，你可以使用node api。</li>
</ul>
<p><img src="https://raw.githubusercontent.com/FoxDaxian/FoxDaxian.github.io/master/assets/12_electron/renderer.png" alt="alt"></p>
<p>主进程使用browserWindow实例创建页面（node层使用browserWindow创建实例），每个browserWindow实例都在自己的渲染进程里运行页面。当一个实例被销毁后，相应的渲染进程也会被终止。（页面层使用remote-本质是eventEmmiter）<br>主进程管理所有页面和与之对应的渲染进程。每个渲染进程都是相互独立的，并且只关心他们自己的页面。<br>几乎所有与底层API进行交互的逻辑都需要在主进程调用。</p>
<h3 id="联想一波"><a href="#联想一波" class="headerlink" title="联想一波"></a>联想一波</h3><p>electron的渲染进程就像谷歌或者其他浏览器中的每个tab，每个web页面就是一个渲染进程<br>如果你关闭所有的tab，chrome仍然没有关闭，这就像主进程，你可以打开新的窗口或退出整个app</p>
<p><img src="https://raw.githubusercontent.com/FoxDaxian/FoxDaxian.github.io/master/assets/12_electron/like-this.png" alt="alt"></p>
<h3 id="通讯方式-参考"><a href="#通讯方式-参考" class="headerlink" title="通讯方式 参考"></a>通讯方式 <a href="https://imweb.io/topic/5b13a663d4c96b9b1b4c4e9c" target="_blank" rel="noopener">参考</a></h3><ol>
<li>ipcmain 主进程使用 ipcrender 渲染进程使用</li>
<li>remote 渲染进程使用</li>
</ol>
<p>本质上是事件的监听订阅。</p>
<h3 id="开发方案"><a href="#开发方案" class="headerlink" title="开发方案"></a>开发方案</h3><h4 id="非单页"><a href="#非单页" class="headerlink" title="非单页"></a>非单页</h4><ul>
<li>electron</li>
<li>hbs（等模板）<br>使用hbs渲染模板，根据机器语言不同的页面风格。使用hbs打包到目标目录，electron直接loadurl。简单高效。</li>
</ul>
<h4 id="单页"><a href="#单页" class="headerlink" title="单页"></a>单页</h4><ul>
<li>electron</li>
<li>mvvm框架</li>
<li>store</li>
<li>router<br>语法是大家所熟悉，不需要再去熟悉模板语言，开发效率高，目录结构清晰，单页用户体验好，不涉及seo问题，但是不支持服务端渲染，除非只做一个架子，但是还得考虑请求时间，毕竟electron是直接加载本地文件。<br>建议还是开发单窗口应用，比如网易云音乐。</li>
</ul>
<h3 id="两个问题"><a href="#两个问题" class="headerlink" title="两个问题"></a>两个问题</h3><ol>
<li>为什么browserWindow在渲染进程中找不到<br>渲染进程本身就是一个browserWindow实例，有些api是通用的有些不是，要是想在渲染进程中使用browserWindow需要引入remote模块</li>
<li>想在渲染进程使用主进程的api<br>需要使用通信，让主进程代劳</li>
</ol>
<p><a href="http://nodejh.com/posts/electron-quick-start/" target="_blank" rel="noopener">参考1</a><br><a href="http://jlord.us/essential-electron/" target="_blank" rel="noopener">参考2</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/memory/2021/05/09/flutter/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FoxDaxian">
      <meta itemprop="description" content="遇到好玩的，稀奇的，新鲜的，记录下来，分享出去。">
      <meta itemprop="image" content="/memory/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fox的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/memory/2021/05/09/flutter/" class="post-title-link" itemprop="url">flutter简析</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2021-05-09 23:37:00" itemprop="dateCreated datePublished" datetime="2021-05-09T23:37:00+00:00">2021-05-09</time>
            </span>
          

          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/memory/categories/原理/" itemprop="url" rel="index"><span itemprop="name">原理</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Flutter"><a href="#Flutter" class="headerlink" title="Flutter"></a>Flutter</h1><h3 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h3><ul>
<li>简介</li>
<li>JIT &amp; AOT</li>
<li>比较</li>
<li>框架结构</li>
<li>数据管理</li>
<li>原理简析</li>
<li>现状</li>
</ul>
<h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>Flutter是谷歌的移动UI框架，主打跨平台、高保真、高性能。可以快速在ios和android上构建高质量的原生用户界面。使用Dart语言开发App。</p>
<ul>
<li>高性能<ul>
<li>开发JIT，发布AOT</li>
<li>使用自己的渲染引擎，无需像rn那样js与native通信</li>
</ul>
</li>
<li>开发效率高<ul>
<li>一份代码多平台使用</li>
<li>热重载</li>
</ul>
</li>
<li>Dart强类型语言</li>
</ul>
<p>实现思路：通过在不同平台实现统一接口的渲染引擎来绘制UI，而不依赖系统原生控件。所以解决的是UI的跨平台问题，如有涉及其他系统能力，依然需要原生开发。<br>Flutter也是受到的React启发，很多思想是相同的，所以有必要去了解react。</p>
<h3 id="JIT-amp-AOT"><a href="#JIT-amp-AOT" class="headerlink" title="JIT &amp; AOT"></a>JIT &amp; AOT</h3><h5 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h5><ul>
<li><p>JIT(动态解释)<br>边运行边编译，边编译边运行。<br><img src="https://raw.githubusercontent.com/FoxDaxian/FoxDaxian.github.io/master/assets/13_flutter/jit.png" alt></p>
</li>
<li><p>AOT(静态编译)<br>把源代码编译成目标代码(机器码、中间字节码)，然后执行<br><img src="https://raw.githubusercontent.com/FoxDaxian/FoxDaxian.github.io/master/assets/13_flutter/aot.png" alt></p>
<h5 id="比较"><a href="#比较" class="headerlink" title="比较"></a>比较</h5><p>JIT优点：</p>
<ol>
<li>根据硬件情况编译最优结果</li>
<li>合理运用内存空间</li>
</ol>
</li>
</ul>
<p>JIT缺点：</p>
<ol>
<li>编译占用运行时资源</li>
<li>需要在程序路畅和编译时间之间权衡</li>
</ol>
<p>AOT优点：</p>
<ol>
<li>避免运行时的性能和内存消耗</li>
<li>大大减少程序启动时间</li>
</ol>
<p>AOT缺点：</p>
<ol>
<li>开发效率低</li>
</ol>
<p>相关推荐： <a href="https://ppt.baomitu.com/user/center" target="_blank" rel="noopener">WebAssembly介绍</a></p>
<h3 id="框架结构"><a href="#框架结构" class="headerlink" title="框架结构"></a>框架结构</h3><p><img src="https://raw.githubusercontent.com/FoxDaxian/FoxDaxian.github.io/master/assets/13_flutter/framework.png" alt></p>
<h4 id="Flutter-Framework"><a href="#Flutter-Framework" class="headerlink" title="Flutter Framework"></a>Flutter Framework</h4><ul>
<li>framework中最下面两层是dary UI层，对应flutter中的<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">- Rendering层，依赖于dart ui层，相当于一个控制器。rendering层会构建出ui树，当ui树有变化的时候，diff，然后更新ui树，在渲染到屏幕上。</span><br><span class="line">- Widgets层是flutter提供的一套基础组件库，在flutter中，可以说一切都是widget</span><br><span class="line"></span><br><span class="line">#### Flutter Engine</span><br><span class="line">- 纯c++实现的sdk，其中包括 skia引擎、 dart运行时、 文字排版引擎等等，在调用dart:ui的时候，调用最终会走到Engine，实现绘制逻辑。</span><br><span class="line"></span><br><span class="line">#### 扩展 - widgets</span><br><span class="line"></span><br><span class="line">**一切皆为widget***</span><br><span class="line"></span><br><span class="line">和html不同，flutter没有css(样式)，也没有js(逻辑)，flutter只有一个个的widget，widget可以表示不同的html元素，比如input，button等等，widget也可以像html那样嵌套使用，不过是放到child中。</span><br><span class="line"></span><br><span class="line">![](https://raw.githubusercontent.com/FoxDaxian/FoxDaxian.github.io/master/assets/13_flutter/widget.png)</span><br><span class="line"></span><br><span class="line">##### 展示Widget</span><br><span class="line">- 你想加载图片，可以使用 ```Image```widget</span><br><span class="line">- 你想居中，可以使用```Center```widget</span><br><span class="line">- 你想采用独特的样式，可以使用```Theme```widget</span><br><span class="line">- 你想添加手势检测，可以使用```GustureDetector```widget</span><br><span class="line">还有常用的```Row```、```Column```、```Container```、```Text```等等</span><br><span class="line"></span><br><span class="line">##### 状态Widget</span><br><span class="line"></span><br><span class="line">- StatelessWidget</span><br><span class="line">- StateFulWidget</span><br><span class="line"></span><br><span class="line">想要管理widget的状态，你需要继承```StateFulWidget</span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 有状态计数器demo</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyHomePage</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  MyHomePage(&#123;Key key, <span class="keyword">this</span>.title&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line">  final <span class="built_in">String</span> title;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 管理自己的状态，重写createState</span></span><br><span class="line">  @override</span><br><span class="line">  _MyHomePageState createState() =&gt; <span class="keyword">new</span> _MyHomePageState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_MyHomePageState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">MyHomePage</span>&gt; </span>&#123;</span><br><span class="line">  int _counter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> _incrementCounter() &#123;</span><br><span class="line">    setState(() &#123;</span><br><span class="line">      _counter++;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Scaffold(</span><br><span class="line">      appBar: <span class="keyword">new</span> AppBar(</span><br><span class="line">        title: <span class="keyword">new</span> Text(widget.title),</span><br><span class="line">      ),</span><br><span class="line">      body: <span class="keyword">new</span> Center(</span><br><span class="line">        child: <span class="keyword">new</span> Column(</span><br><span class="line">          mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">          children: <span class="xml"><span class="tag">&lt;<span class="name">Widget</span>&gt;</span>[</span></span><br><span class="line"><span class="xml">            new Text(</span></span><br><span class="line"><span class="xml">              '第一行',</span></span><br><span class="line"><span class="xml">            ),</span></span><br><span class="line"><span class="xml">            new Text(</span></span><br><span class="line"><span class="xml">              '$_counter'</span></span><br><span class="line"><span class="xml">            ),</span></span><br><span class="line"><span class="xml">          ],</span></span><br><span class="line"><span class="xml">        ),</span></span><br><span class="line"><span class="xml">      ),</span></span><br><span class="line"><span class="xml">      floatingActionButton: new FloatingActionButton(</span></span><br><span class="line"><span class="xml">        onPressed: _incrementCounter,</span></span><br><span class="line"><span class="xml">        tooltip: 'Increment',</span></span><br><span class="line"><span class="xml">        child: new Icon(Icons.add),</span></span><br><span class="line"><span class="xml">      ), // This trailing comma makes auto-formatting nicer for build methods.</span></span><br><span class="line"><span class="xml">    );</span></span><br><span class="line"><span class="xml">  &#125;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br></pre></td></tr></table></figure>

<p><a href="https://github.com/FoxDaxian/flutter_weixin/blob/master/lib/page/home/listItem.dart" target="_blank" rel="noopener">无状态demo</a></p>
<h3 id="数据管理"><a href="#数据管理" class="headerlink" title="数据管理"></a>数据管理</h3><p>常见的有：</p>
<ul>
<li>flutter_redux</li>
<li>event_bus(推荐)</li>
</ul>
<h5 id="event-bus"><a href="#event-bus" class="headerlink" title="event_bus"></a>event_bus</h5><p>事件总线模式、发布订阅模式<br>减少耦合，统一管理状态</p>
<p><img src="https://raw.githubusercontent.com/FoxDaxian/FoxDaxian.github.io/master/assets/13_flutter/event-bus.png" alt></p>
<p>n步曲</p>
<ul>
<li><p>创建event bus(支持同步、异步)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:event_bus/event_bus.dart'</span>;</span><br><span class="line">EventBus eventBus = EventBus();</span><br></pre></td></tr></table></figure>
</li>
<li><p>定义类</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserLoggedInEvent</span> </span>&#123;</span><br><span class="line">  User user;</span><br><span class="line"></span><br><span class="line">  UserLoggedInEvent(<span class="keyword">this</span>.user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>订阅</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">eventBus.on&lt;UserLoggedInEvent&gt;().listen((event) &#123;</span><br><span class="line">  print(event.user);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 监听所有</span></span><br><span class="line">eventBus.on().listen((event) &#123;</span><br><span class="line">  print(event.user);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>发布</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User myUser = User(<span class="string">'fox'</span>);</span><br><span class="line">eventBus.fire(UserLoggedInEvent(myUser));</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="原理简析"><a href="#原理简析" class="headerlink" title="原理简析"></a><a href="https://www.stephenw.cc/2018/05/14/flutter-principle/" target="_blank" rel="noopener">原理简析</a></h3><h3 id="现状"><a href="#现状" class="headerlink" title="现状"></a>现状</h3><p>今天google i/o大会，flutter团队宣布已支持移动、web、桌面和嵌入式设备。</p>
<p><img src="https://raw.githubusercontent.com/FoxDaxian/FoxDaxian.github.io/master/assets/13_flutter/flutternow.jpg" alt></p>
<p>同时发布了flutter for web的首个技术预览版，宣布flutter正在为包括google home hub在内的google只能平台提供支持。</p>
<p>flutter for web是flutter的代码兼容版本，使用基于标准的web技术(html, css, javascript)进行渲染，通过flutter for web，可以将dart编写的flutter代码编译成嵌入到浏览器，并部署到任何web服务器的客户端版本。开发者可以使用flutter的所有特性而无需浏览器插件。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/memory/2021/05/09/gaosimohu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FoxDaxian">
      <meta itemprop="description" content="遇到好玩的，稀奇的，新鲜的，记录下来，分享出去。">
      <meta itemprop="image" content="/memory/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fox的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/memory/2021/05/09/gaosimohu/" class="post-title-link" itemprop="url">图片高斯模糊</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2021-05-09 23:37:00" itemprop="dateCreated datePublished" datetime="2021-05-09T23:37:00+00:00">2021-05-09</time>
            </span>
          

          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/memory/categories/原理/" itemprop="url" rel="index"><span itemprop="name">原理</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>图片加载一个老生常谈的问题，由于最近工作中经常有h5宣传页的需求，所以也看了一些方案</p>
<ul>
<li>medium网站上提高用户体验的图片高斯模糊加载<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- figure，代表一段独立的内容，常用语引用图片、插图、表格、代码段等等 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">figure</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 图片容器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"aspectRatioPlaceholder is-locked"</span> <span class="attr">style</span>=<span class="string">"max-width: 383px; max-height: 326px;"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 放置reflow的占位元素，style上的padding-bottom是通过接下来相邻div上写好的图片宽高计算而来，可通过十字相乘得到高度百分比 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"aspectRatioPlaceholder-fill"</span> <span class="attr">style</span>=<span class="string">"padding-bottom: 85.1%;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 实际的图片信息，包括图片id和图片宽高 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">data-image-id</span>=<span class="string">"1*MZY5pNF7fgOarY-J2fNuHQ.png"</span> <span class="attr">data-width</span>=<span class="string">"383"</span> <span class="attr">data-height</span>=<span class="string">"326"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 可以看到png后缀后有一个query: ?q=20，这个是缩略图的质量，猜想是二十分之一？ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"https://cdn-images-1.medium.com/freeze/max/60/1*MZY5pNF7fgOarY-J2fNuHQ.png?q=20"</span> <span class="attr">crossorigin</span>=<span class="string">"anonymous"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 获取上面的图片，渲染到canvas中，canvas宽高为实际的图片宽高，并添加高斯模糊效果，以获取较好的用户体验 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">canvas</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 真正的图片 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"https://cdn-images-1.medium.com/max/1600/1*MZY5pNF7fgOarY-J2fNuHQ.png"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 向后兼容，在不支持js脚本或者支持js脚本，但认为禁止js脚本的浏览器中可以被识别 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">noscript</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">img</span>  <span class="attr">src</span>=<span class="string">"https://cdn-images-1.medium.com/max/1600/1*MZY5pNF7fgOarY-J2fNuHQ.png"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">noscript</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">figure</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<ol>
<li>诺，可以先看一遍上面HTML代码中的注释，加上一点自己的理解，估计你能理解个大概</li>
<li>首先，准备一个真正需要展示给用户的图片和一个可以通过query来生成不同质量的缩略图的服务，哈哈</li>
<li>然后先加载质量很小很小的缩略图，然后通过div上设置的图片真正宽高，渲染到canvas中，并添加合适的高斯模糊效果</li>
<li>然后可以通过network中看到，等小图加载完毕后，再去加载原图，保证页面第一版加载更快，缩短执行js的时间</li>
<li>原图加载完毕后，显示原图，隐藏之前的canvas</li>
<li>对了，还有一个placeholder元素，这个是为了放置切换时造成的reflow，这个需要js动态设置图片容器的宽高，然后通过比例设置placeholder元素的padding-bottom</li>
<li>元素上使用了自定义属性，一个通用的、赋予html数据属性的特性，解决了自定义属性混乱无管理的情况，css选择器也可以选中它哦</li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/memory/2021/05/09/gujiaping/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FoxDaxian">
      <meta itemprop="description" content="遇到好玩的，稀奇的，新鲜的，记录下来，分享出去。">
      <meta itemprop="image" content="/memory/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fox的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/memory/2021/05/09/gujiaping/" class="post-title-link" itemprop="url">骨架屏</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2021-05-09 23:37:00" itemprop="dateCreated datePublished" datetime="2021-05-09T23:37:00+00:00">2021-05-09</time>
            </span>
          

          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/memory/categories/原理/" itemprop="url" rel="index"><span itemprop="name">原理</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>骨架屏</p>
<p>对于前端来说，最重要的莫过于用户体验了，这次我们聊一聊骨架屏 - Skeleton Screen</p>
<p>我们平常对于需要请求加载的内容，可能用的比较多的是loading动画，比如在内容区域放一个菊花图，当请求结束，并且render tree构造完成后，将菊花图移除，展示用户想看的内容。虽然这种方式没啥缺点，但是现在更多的网站开始使用骨架屏代替，因为它能带过来更好的用户体验。<br>我们看几个例子：</p>
<p>facebook<br><img src="https://raw.githubusercontent.com/FoxDaxian/FoxDaxian.github.io/master/assets/09_skeleton%20_screen/facebook.jpeg" alt="facebook"></p>
<p>jira<br><img src="https://raw.githubusercontent.com/FoxDaxian/FoxDaxian.github.io/master/assets/09_skeleton%20_screen/jira.png" alt="jira"></p>
<p>linkedin<br><img src="https://raw.githubusercontent.com/FoxDaxian/FoxDaxian.github.io/master/assets/09_skeleton%20_screen/linkedin.jpeg" alt="linkedin"></p>
<p>slack<br><img src="https://raw.githubusercontent.com/FoxDaxian/FoxDaxian.github.io/master/assets/09_skeleton%20_screen/slack.png" alt="slack"></p>
<p>上图展示中，我们可以看到每个site从骨架图到真实内容的一个变化。如果你细心一点你会发现，不同site对于骨架图的block位置是不一致的：</p>
<ul>
<li>facebook将用户固定的头像，author，日期和一小部分文字作为骨架主体</li>
<li>jira则是标题和logo对应的很整齐</li>
<li>linkedin可以说完全没有对齐，而是使用一种更加的展示骨架布局</li>
<li>slack则是使用混合的loading方式，有骨架图也有旋转圆，不仅如此，slack并没有全部使用同一种灰色值，不同的block的颜色代表的该区域的字体颜色，这又是一种切换顺滑度的提升。</li>
</ul>
<p>不过他们都有一个共同点，就是采用简约的方式布局，我们可以以此为例，创造出独一无二的风格，来提高用户体验和加强品牌的风格，我想这会比一个loading logo带来更好的效果。</p>
<p>上面简单的介绍了一下骨架图，接下来我们来说一下具体实现吧。</p>
<p> 优先我们实现一个简单的带有loading效果的骨架结构：</p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">        *&#123;</span><br><span class="line">            margin: 0;</span><br><span class="line">            padding: 0;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        @<span class="keyword">keyframes</span> loading &#123;</span></span><br><span class="line">            0% &#123;</span><br><span class="line">                background-position: -400px 0</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            100% &#123;</span><br><span class="line">                background-position: 400px 0</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">        <span class="selector-class">.box1</span> &#123;</span></span><br><span class="line">            position: absolute;</span><br><span class="line">            margin: 0 auto;</span><br><span class="line">            left: 50%;</span><br><span class="line">            margin-left: -400px;</span><br><span class="line">            top: 0;</span><br><span class="line">            width: 800px;</span><br><span class="line">            height: 60px;</span><br><span class="line">            background-color: blue;</span><br><span class="line"><span class="css">            <span class="selector-tag">background-image</span>: <span class="selector-tag">linear-gradient</span>(<span class="selector-tag">to</span> <span class="selector-tag">right</span>, <span class="selector-id">#eeeeee</span> 8%, <span class="selector-id">#dddddd</span> 18%, <span class="selector-id">#eeeeee</span> 33%);</span></span><br><span class="line">            animation-duration: 1s;</span><br><span class="line">            animation-iteration-count: infinite;</span><br><span class="line">            animation-name: loading;</span><br><span class="line">            animation-timing-function: linear;</span><br><span class="line"><span class="css">            <span class="selector-tag">transition</span>: 0<span class="selector-class">.3s</span>;</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="selector-class">.bgMasker</span> &#123;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">background-color</span>: <span class="selector-id">#fff</span>;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">        <span class="selector-class">.line1</span> &#123;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">background-color</span>: <span class="selector-id">#fff</span>;</span></span><br><span class="line">            height: 20px;</span><br><span class="line">            position: absolute;</span><br><span class="line">            right: 0;</span><br><span class="line">            top: 0;</span><br><span class="line">            left: 60px;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">        <span class="selector-class">.line2</span> &#123;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">background-color</span>: <span class="selector-id">#fff</span>;</span></span><br><span class="line">            height: 20px;</span><br><span class="line">            position: absolute;</span><br><span class="line">            right: 700px;</span><br><span class="line">            top: 20px;</span><br><span class="line">            left: 60px;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">        <span class="selector-class">.line3</span> &#123;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">background-color</span>: <span class="selector-id">#fff</span>;</span></span><br><span class="line">            height: 20px;</span><br><span class="line">            position: absolute;</span><br><span class="line">            left: 400px;</span><br><span class="line">            right: 0;</span><br><span class="line">            top: 20px;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">        <span class="selector-class">.line4</span> &#123;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">background-color</span>: <span class="selector-id">#fff</span>;</span></span><br><span class="line">            height: 20px;</span><br><span class="line">            top: 40px;</span><br><span class="line">            position: absolute;</span><br><span class="line">            left: 60px;</span><br><span class="line">            right: 500px;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">        <span class="selector-class">.line5</span> &#123;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">background-color</span>: <span class="selector-id">#fff</span>;</span></span><br><span class="line">            height: 20px;</span><br><span class="line">            position: absolute;</span><br><span class="line">            left: 600px;</span><br><span class="line">            right: 0;</span><br><span class="line">            top: 40px;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 骨架 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box1"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"bgMasker line1"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"bgMasker line2"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"bgMasker line3"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"bgMasker line4"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"bgMasker line5"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p> 有一点需要说一下，由于我们使用的是渐变色的动画效果，所以我们的布局有一点的变化，我们采用的是整体加上背景色，然后内容使用定位和left,right来构成block的方式，具体内容请参考上面的代码</p>
<p>效果如下：</p>
<p><img src="https://raw.githubusercontent.com/FoxDaxian/FoxDaxian.github.io/master/assets/09_skeleton%20_screen/block.gif" alt="block"></p>
<p>然后我们做一下简单的骨架图和内容的切换，这里就不贴代码了，切换有很多种实现方式，不固定思维。我这边做了两种，一种是直接切换，一种是淡入的切换，可以简单参考一下：</p>
<p><img src="https://raw.githubusercontent.com/FoxDaxian/FoxDaxian.github.io/master/assets/09_skeleton%20_screen/static.gif" alt="block"></p>
<p><img src="https://raw.githubusercontent.com/FoxDaxian/FoxDaxian.github.io/master/assets/09_skeleton%20_screen/animate.gif" alt="block"></p>
<hr>
<p><a href="https://github.com/Jocs/jocs.github.io/issues/22" target="_blank" rel="noopener">饿了么骨架图方案</a></p>
<ol>
<li>ssr，请求后用puppeteer插入script生成当前页的骨架图，或者build的时候直接生成（个人觉得应该是这种），然后插入到根元素内，然后数据加载后直接隐藏并展示真实数据</li>
<li>分块，对于图片，将采用最小大小尺寸 1 * 1的纯色gif图，然后进行拉伸</li>
<li>数据请求后对骨架进行隐藏等操作</li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/memory/2021/05/09/httpReferer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FoxDaxian">
      <meta itemprop="description" content="遇到好玩的，稀奇的，新鲜的，记录下来，分享出去。">
      <meta itemprop="image" content="/memory/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fox的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/memory/2021/05/09/httpReferer/" class="post-title-link" itemprop="url">http referer</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2021-05-09 23:37:00" itemprop="dateCreated datePublished" datetime="2021-05-09T23:37:00+00:00">2021-05-09</time>
            </span>
          

          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/memory/categories/原理/" itemprop="url" rel="index"><span itemprop="name">原理</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>referer指的是请求来自哪里，值为url格式，大白话说，就是你是从哪里访问的当前网站。<br>常用来检测方可来自于哪，比如防盗链、恶意请求等等<br><img src="https://raw.githubusercontent.com/FoxDaxian/FoxDaxian.github.io/master/assets/picgo/20190628193343.png" alt></p>
<h3 id="防盗链"><a href="#防盗链" class="headerlink" title="防盗链"></a>防盗链</h3><p>打个比方，如果用户请求一个资源，比如下载链接地址，那么下载链接地址的referer就指向你的来源地址，这时候你就可以通过referer判断是否来自你的域下，进行安全权限检测，对来源进行限制。不过如果你直接输入url打开的下载链接地址，那么referer就不存在或者为空，你又可以做其他的骚操作。<br>总之referer用好，会让你的网站更安全、也更灵活.</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/memory/2021/05/09/jsModule/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FoxDaxian">
      <meta itemprop="description" content="遇到好玩的，稀奇的，新鲜的，记录下来，分享出去。">
      <meta itemprop="image" content="/memory/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fox的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/memory/2021/05/09/jsModule/" class="post-title-link" itemprop="url">js模块的前生今世</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2021-05-09 23:37:00" itemprop="dateCreated datePublished" datetime="2021-05-09T23:37:00+00:00">2021-05-09</time>
            </span>
          

          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/memory/categories/原理/" itemprop="url" rel="index"><span itemprop="name">原理</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>我曾经做过js讲师，在我的任教过程中，模块系统一直是学生们的薄弱点。有一个充分的理由可以解释这个问题：<strong><em>模块在javascript中有一段奇怪且不稳定的历史</em></strong>。这篇文章我们将讨论这段历史，并且，你讲了解过去的模块的相关知识，以更好的理解当前模块的工作原理。<br>在学习如何在js中创建模块之前，首先需要明白，模块是什么以及为什么会存在模块。环顾你的周边，你会发现，很多复杂的东西都是有一个个分离的部件组合在一起构成，进而形成一个完整的东西。</p>
<p>以一只手表为例：</p>
<p><img src="https://raw.githubusercontent.com/FoxDaxian/FoxDaxian.github.io/master/assets/06_js_module/watch-internals.jpg" alt="手表结构"></p>
<p>可以看到，一只手表由成百上千的内部部件组成，每一个内部部件都有特定的功能和清晰地边界以方便与其他部件协作。把这些部件组合在一起，就组成了这只完整的手表。我不是一个手表制造业的专家，但是我因为这种方法的优点是非常直观的。</p>
<h4 id="可复用性"><a href="#可复用性" class="headerlink" title="可复用性"></a>可复用性</h4><p>如果你仔细的观察一些上图中的构造，你会发现有很多部件都是重复的。由于这种模块化为中心的设计，手表中的不同功能也可以用到相同的部件。这种可复用部件的能力简化的工作制造流程，并且提高的利润。</p>
<h4 id="可组合性"><a href="#可组合性" class="headerlink" title="可组合性"></a>可组合性</h4><p>这种设计是可组合性的非常直观的案例。通过制定每个部件清晰地边界，能够很好地组合每一个部件，以创造一个功能齐全的手表。</p>
<h4 id="可利用性（或许有更好的解释？）"><a href="#可利用性（或许有更好的解释？）" class="headerlink" title="可利用性（或许有更好的解释？）"></a>可利用性（或许有更好的解释？）</h4><p>设想一下制造过程，公司不会制造手表，他们只是将这些部件拼接起来以产出一只完整的手表。他们可以自己制作这些部件，也可以将这些部件外包给其他工厂，这不重要，重要的是这些部件组合在一起就是一只完整的手表，而这些部件来自于哪是无关紧要的。</p>
<h4 id="隔离性"><a href="#隔离性" class="headerlink" title="隔离性"></a>隔离性</h4><p>明白手表的整个系统是很困难的，因为它由很多小而复杂的，功能专一的部件组成，每个部件都可以单独考虑，构造和修复。这种隔离性允许人们单独工作，不会成为彼此的负担。并且，如果一个部件循环，仅仅需要更换这个部件看，而不是更换这只表。</p>
<h4 id="组织化"><a href="#组织化" class="headerlink" title="组织化"></a>组织化</h4><p>组织是每个独立的拥有清晰边界的部件为了与其他部件组合的副产品，伴随着模块化，自然就会出现这种情况。</p>
<p>随着手表这样的结构不断产出，我们可以越来越清晰地认识到模块化的好处，那么，如果我们换成软件领域呢？其实是一样的。就像手表的设计一样，软件也应该被设计，分割成不同的具有特定功能的部件，并且具有为了与其他部件组合的清晰边界。不过，在软件中，这种部件被叫做模<strong><em>模块</em></strong>。到现在为止，模块给我们的感觉可能与react组件和函数大相径庭。那模块到底包含什么呢？</p>
<p><em>每一个模块都具有三部分：依赖，代码内容还有导出。</em></p>
<h4 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h4><p>当一个模块需要其他模块的功能，它可以<figure class="highlight plain"><figcaption><span>react```模块，如果你想使用``` lodash```，你也只需要```impiort lodash```模块。</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### code</span><br><span class="line"></span><br><span class="line">确定好你的模块需要的依赖之后，你就可以开始编写这个模块</span><br><span class="line"></span><br><span class="line">#### exports</span><br><span class="line"></span><br><span class="line">```exports```是当前模块的```接口```，引入这个模块的开发者可以使用你导出的一切功能。</span><br><span class="line"></span><br><span class="line">说了这么多概念，下面让我们来点实际的代码。</span><br><span class="line"></span><br><span class="line">先来看一个react router的例子，方便起见，可以看一下react提供的[模块目录](https://github.com/ReactTraining/react-router/tree/master/packages/react-router/modules)，在react router中合理的利用模块，事实证明，在大多数情况下，他们直接映射react组件到模块，在react项目中分离组件是很有意义的，重新审查上面的手表结构，将部件换成组件同样有意义。</span><br><span class="line"></span><br><span class="line">来看一下```MemoryRouter```模块的代码，现在不要关心代码的含义，只需要集中在代码的结构上。</span><br><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">// imports</span><br><span class="line">import React from &apos;react&apos;;</span><br><span class="line">import &#123; createMemoryHistory &#125; from &apos;history&apos;;</span><br><span class="line">import Router from &apos;./Router&apos;;</span><br><span class="line"></span><br><span class="line">// code</span><br><span class="line">class MemoryRouter extends React.Component &#123;</span><br><span class="line">    history = createMemoryHistory(this.props);</span><br><span class="line">    </span><br><span class="line">    render() &#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;Router</span><br><span class="line">            history=&#123;this.history&#125;</span><br><span class="line">            children=&#123;this.props.children&#125;</span><br><span class="line">            /&gt;;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//exports</span><br><span class="line">export default MemoryRouter;</span><br></pre></td></tr></table></figure></p>
<p>你可以注意到这个模块的顶部定义了依赖，和一些使当前模块正产工作的必需的模块。接下来，可以看到一些代码。在这个例子中，创建了一个叫做MemoryRouter的新的react组件，最后，在底部定义了对外导出：MemoryRouter，也就是说，任何导入该模块的模块都会得到MemoryRouter这个组件。</p>
<p>现在，我们对软件中的模块有了一个浅显的认识，让我们回顾一些手表设计带来的好处，在相同设计的软件中有哪些可以可以直接应用。</p>
<h4 id="可复用性-1"><a href="#可复用性-1" class="headerlink" title="可复用性"></a>可复用性</h4><p>因为模块可以在任何需要它的地方<figure class="highlight plain"><figcaption><span>reacrt```、```lodash```还有```jquery```都是可以从npm上下载的npm包。</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 可组合性</span><br><span class="line"></span><br><span class="line">由于模块定义了导入和导出，所以很容易组合起来，不仅如此。一个软件好的设计应该是低耦合，模块增加了代码的灵活性。</span><br><span class="line"></span><br><span class="line">#### 可利用性</span><br><span class="line"></span><br><span class="line">npm上有世界上数量最多的免费模块，超过七十万个，如果你需要某个功能的包，就去npm上找吧。</span><br><span class="line"></span><br><span class="line">#### 隔离性</span><br><span class="line"></span><br><span class="line">这里使用手表的描述也是合适的。不在赘述。</span><br><span class="line"></span><br><span class="line">#### 组织化</span><br><span class="line"></span><br><span class="line">模块最大的好处也许是组织化了，模块带来的分离，正如你所见的，帮助你避免污染全局命名空间，减少命名冲突。</span><br><span class="line"></span><br><span class="line">-----</span><br><span class="line"></span><br><span class="line">现在你大概了解了模块的结构和优点。是时候正式构建模块了。对此我们的方法是非常有条理的。原因是之前提到的，javascript中的模块有非常奇怪的历史，即使有更新的方法在javascript中创建模块，你也会时不时的看到一些老的创建方式。如果模块从2018年开始，这个可能没有一点用处，也就是说，我们会回到2010年的```模块```时代。那时，angularjs刚刚发布，jquery还在大范围使用。大部分公司使用javascript去构建复杂的web应用，而管理这些复杂的工具就是--模块。</span><br><span class="line"></span><br><span class="line">创建模块的第一个想法可能就是用文件分离代码。</span><br><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">// users.js</span><br><span class="line">var users = [&apos;Tyler&apos;, &apos;Sarah&apos;, &apos;Dan&apos;];</span><br><span class="line"></span><br><span class="line">function getUsers() &#123;</span><br><span class="line">    return users;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// dom.js</span><br><span class="line">function addUserToDom(name) &#123;</span><br><span class="line">    var node = document.createElement(&apos;li&apos;);</span><br><span class="line">    var text = document.createTextNode(name);</span><br><span class="line">    node.appendChild(text);</span><br><span class="line">    </span><br><span class="line">    document.getElementById(&apos;users&apos;).appendChild(node);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">document.getElementById(&apos;submit&apos;)</span><br><span class="line">    .addEventListener(&apos;click&apos;, function() &#123;</span><br><span class="line">        var input = document.getElementById(&apos;input&apos;);</span><br><span class="line">        addUserToDom(input.value);</span><br><span class="line">        input.value = &apos;&apos;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">var users = window.getUsers();</span><br><span class="line">for (var i = 0; i &lt; users.length; i++) &#123;</span><br><span class="line">    addUserToDom(users[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Users<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Users<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"users"</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag">      <span class="attr">id</span>=<span class="string">"input"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">type</span>=<span class="string">"text"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">placeholder</span>=<span class="string">"New User"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">input</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"submit"</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"users.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"dom.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><a href="https://github.com/tylermcginnis/modules/tree/separate-files" target="_blank" rel="noopener">这里</a>查看全部源代码</p>
<p>ok，我们成功的将app分离成不同的功能文件，是不是意味着我们已经实现了模块？不，绝对没有。我们做的只不过是分离代码所在的位置。在js中，只有创建函数才能生成新的作用域。我们未在函数中生命的变量，全都在全局对象上。也就是说，你可以访问他们通过<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">那么，如果分享分离没有给我们提供模块的功能，那我们要怎么做呢？重复强调一下模块的优点:复用性、组合型、利用性、隔离性还有可组织性。js有没有原始的特性以供我们创造模块，以达到上面说的优点？常规函数？当你思考函数的特点，它的特点和模块优点相似。所以，接下来该怎么做呢？如果我们暴露一个对象来替代直接把整个app暴露在全局对象下，并且命名这个对象为```app```，我们可以吧所有我们app需要用到的方法，挂在在这个```app```对象下。这样会防止我们污染全局变量。我们可以在里面放置任何东西，这样对于其他应用来说依然是不可见得。</span><br><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">// users.js</span><br><span class="line">function usersWrapper () &#123;</span><br><span class="line">  var users = [&quot;Tyler&quot;, &quot;Sarah&quot;, &quot;Dan&quot;]</span><br><span class="line"></span><br><span class="line">  function getUsers() &#123;</span><br><span class="line">    return users</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  APP.getUsers = getUsers</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">usersWrapper()</span><br><span class="line"></span><br><span class="line">// dom.js</span><br><span class="line"></span><br><span class="line">function domWrapper() &#123;</span><br><span class="line">  function addUserToDOM(name) &#123;</span><br><span class="line">    const node = document.createElement(&quot;li&quot;)</span><br><span class="line">    const text = document.createTextNode(name)</span><br><span class="line">    node.appendChild(text)</span><br><span class="line"></span><br><span class="line">    document.getElementById(&quot;users&quot;)</span><br><span class="line">      .appendChild(node)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  document.getElementById(&quot;submit&quot;)</span><br><span class="line">    .addEventListener(&quot;click&quot;, function() &#123;</span><br><span class="line">      var input = document.getElementById(&quot;input&quot;)</span><br><span class="line">      addUserToDOM(input.value)</span><br><span class="line"></span><br><span class="line">      input.value = &quot;&quot;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  var users = APP.getUsers()</span><br><span class="line">  for (var i = 0; i &lt; users.length; i++) &#123;</span><br><span class="line">    addUserToDOM(users[i])</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">domWrapper()</span><br></pre></td></tr></table></figure></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Users<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Users<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"users"</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag">      <span class="attr">id</span>=<span class="string">"input"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">type</span>=<span class="string">"text"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">placeholder</span>=<span class="string">"New User"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">input</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"submit"</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"app.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"users.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"dom.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><a href="https://github.com/tylermcginnis/modules/tree/wrappers" target="_blank" rel="noopener">这里</a>查看全部源代码</p>
<p>现在你查看window对象，相比于，只有我们的<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">让我们更进一步。有没有办法可以丢弃包裹函数？我们只是定义了它们，然后立即调用。给他们一个全局命名的唯一原因就是我们之后可以立即调用它们。如果我们没有给他们全局命名，有没有办法直接直接调用没有名字（匿名）的函数。不卖关子了，当然有了，就是```Immediately Invoked Function Expression```，简写为```IIFE```。</span><br><span class="line"></span><br><span class="line">#### IIFE</span><br><span class="line"></span><br><span class="line">它看起来像下面这样：</span><br><span class="line">```javascript</span><br><span class="line">(function() &#123;</span><br><span class="line">    console.log(&apos;Pronounced IF-EE&apos;);</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure></p>
<p>注意，这仅仅是一个被小括号<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">```javascript</span><br><span class="line">(function() &#123;</span><br><span class="line">    console.log(&apos;Pronounced IF-EE&apos;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>然后，就像其他函数一样，为了调用函数，我们增加了一对小括号在函数而最后。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Pronounced IF-EE'</span>);</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<p>现在，为了放弃丑陋的包裹函数和干净的全局命名空间让我们来使用<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">// users.js</span><br><span class="line"></span><br><span class="line">(function () &#123;</span><br><span class="line">  var users = [&quot;Tyler&quot;, &quot;Sarah&quot;, &quot;Dan&quot;]</span><br><span class="line"></span><br><span class="line">  function getUsers() &#123;</span><br><span class="line">    return users</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  APP.getUsers = getUsers</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line">// dom.js</span><br><span class="line"></span><br><span class="line">(function () &#123;</span><br><span class="line">  function addUserToDOM(name) &#123;</span><br><span class="line">    const node = document.createElement(&quot;li&quot;)</span><br><span class="line">    const text = document.createTextNode(name)</span><br><span class="line">    node.appendChild(text)</span><br><span class="line"></span><br><span class="line">    document.getElementById(&quot;users&quot;)</span><br><span class="line">      .appendChild(node)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  document.getElementById(&quot;submit&quot;)</span><br><span class="line">    .addEventListener(&quot;click&quot;, function() &#123;</span><br><span class="line">      var input = document.getElementById(&quot;input&quot;)</span><br><span class="line">      addUserToDOM(input.value)</span><br><span class="line"></span><br><span class="line">      input.value = &quot;&quot;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  var users = APP.getUsers()</span><br><span class="line">  for (var i = 0; i &lt; users.length; i++) &#123;</span><br><span class="line">    addUserToDOM(users[i])</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure></p>
<p><a href="https://github.com/tylermcginnis/modules/tree/IIFEs" target="_blank" rel="noopener">这里</a>查看全部源代码</p>
<p>么么哒。现在你在查看window对象，你会发现，我们仅仅挂在了一个app对象在上面，他将作为全局方法的命名空间。</p>
<p>这就是IIFE模块模式。</p>
<p>IIFE模块模式有什么优点呢？首先，最重要的一点是，我们没有污染全局命名空间，这避免了变量冲突，并且提供代码私有性。有利就有弊，我们仍然有一个全局app变量，如果其他框架使用了相同的代码，我们就有麻烦了。第二点，你可能主要到了html文件中的script的顺序，如果顺序不对，那么app直接会挂掉。<br>不过，就算这不是最完美的。我们依然进步了一大块。我们知道了IIFE模块模式的优点和缺点。如果我们用我们的标准创建并管理模块，它有哪些特性呢？</p>
<p>早些时候，我们对模块分离的第一感觉每个文件都是一个新的模块。就算这种想法在js中不是开箱就用的。我认为对模块来说这是一个非常显著的分离。每个文件就是一个单独的模块，然后我们需要一个特性是每个文件（模块）都能定义自己的导入和导出。并可在其他文件（模块）中导入。</p>
<h4 id="我们的标准"><a href="#我们的标准" class="headerlink" title="我们的标准"></a>我们的标准</h4><ul>
<li>基于文件的模块</li>
<li>明确的导入</li>
<li>明确的导出</li>
</ul>
<p>现在，我们明确了我们想要的标准，让我们开始开发api。我们需要定义的看起来像是<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">var users = [&quot;Tyler&quot;, &quot;Sarah&quot;, &quot;Dan&quot;]</span><br><span class="line"></span><br><span class="line">function getUsers() &#123;</span><br><span class="line">  return users</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports.getUsers = getUsers</span><br></pre></td></tr></table></figure></p>
<p>也可以这样：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> users = [<span class="string">"Tyler"</span>, <span class="string">"Sarah"</span>, <span class="string">"Dan"</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUsers</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> users</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  getUsers: getUsers</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>不管有多少个方法，我们都可以添加到<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">// users.js</span><br><span class="line"></span><br><span class="line">var users = [&quot;Tyler&quot;, &quot;Sarah&quot;, &quot;Dan&quot;]</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">  getUsers: function () &#123;</span><br><span class="line">    return users</span><br><span class="line">  &#125;,</span><br><span class="line">  sortUsers: function () &#123;</span><br><span class="line">    return users.sort()</span><br><span class="line">  &#125;,</span><br><span class="line">  firstUser: function () &#123;</span><br><span class="line">    return users[0]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>好了，我们解决了如何从模块导出，接下来我们需要解决如何导入。同样一切从简，首先假设我们有一个叫做<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">var users = require(&apos;./users&apos;)</span><br><span class="line"></span><br><span class="line">users.getUsers() // [&quot;Tyler&quot;, &quot;Sarah&quot;, &quot;Dan&quot;]</span><br><span class="line">users.sortUsers() // [&quot;Dan&quot;, &quot;Sarah&quot;, &quot;Tyler&quot;]</span><br><span class="line">users.firstUser() // [&quot;Tyler&quot;]</span><br></pre></td></tr></table></figure></p>
<p>哦耶~ 利用假象的<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">看完这个标准，有没有灵光一现？这tm不就是commonjs吗？</span><br><span class="line"></span><br><span class="line">commonjs小组定义了模块模式去解决js作用域问题，以确保每个模块在他们自己的命名空间执行。通过模块明确导出那些变量来实现，通过其他模块定义的require来正确工作。</span><br><span class="line">如果你之前使用过node，conmonjs你会很熟悉。使用node，你可以开箱即用的使用require和module.exports语法，不过，浏览器并未支持。事实上，就算浏览器支持，浏览器也不会使用commonjs，因为它不是异步加载模块。众所周知，浏览器是单线程。异步才是王道。</span><br><span class="line">简单总结一下，commonjs有两个问题，首先浏览器不支持，第二，浏览器就算支持了也会因为commonjs的同步加载造成很糟糕的用户体验。如果我们能修复这两个问题，这也许是一个好的方案。不过，花费很多的时间去考虑研究commonjs是否对浏览器足够友好有没有意义呢？不管怎么样，这有一个新的解决方案，它叫做模块打包器。</span><br><span class="line"></span><br><span class="line">#### 模块打包器</span><br><span class="line"></span><br><span class="line">模块打包器的作用是检查你的代码库。寻找所有的imports和exports，然后解析打包成浏览器可以明白的代码到一个单独的新文件。而且你不再用小心翼翼的引入所有script，你应该直接引入打包好的那个文件。</span><br><span class="line"></span><br><span class="line">app.js ---&gt; | </span><br><span class="line">users.js -&gt; | Bundler | -&gt; bundle.js</span><br><span class="line">dom.js ---&gt; | </span><br><span class="line"></span><br><span class="line">所以，模块打包器到底做了什么捏？这个问题很大，我也不能全部解释清楚，不过，这有一个通过webpack打包之后的输出，你可以自己领悟领悟，哈哈。</span><br><span class="line"></span><br><span class="line">[这里](https://github.com/tylermcginnis/modules/tree/commonjs)查看所有源代码，你也可以下载下来，执行 npm install，然后执行webpack</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">(function(modules) &#123; // webpackBootstrap</span><br><span class="line">  // 模块缓存</span><br><span class="line">  var installedModules = &#123;&#125;;</span><br><span class="line">  // require函数</span><br><span class="line">  function __webpack_require__(moduleId) &#123;</span><br><span class="line">    // 检查module是否有缓存</span><br><span class="line">    if(installedModules[moduleId]) &#123;</span><br><span class="line">      return installedModules[moduleId].exports;</span><br><span class="line">    &#125;</span><br><span class="line">    // 创建一个module并缓存</span><br><span class="line">    var module = installedModules[moduleId] = &#123;</span><br><span class="line">      i: moduleId,</span><br><span class="line">      l: false,</span><br><span class="line">      exports: &#123;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    // 执行module</span><br><span class="line">    modules[moduleId].call(</span><br><span class="line">      module.exports,</span><br><span class="line">      module,</span><br><span class="line">      module.exports,</span><br><span class="line">      __webpack_require__</span><br><span class="line">    );</span><br><span class="line">    // 设置module为已load</span><br><span class="line">    module.l = true;</span><br><span class="line">    // 返回模块的导出</span><br><span class="line">    return module.exports;</span><br><span class="line">  &#125;</span><br><span class="line">  // 暴露模块对象</span><br><span class="line">  __webpack_require__.m = modules;</span><br><span class="line">  // 暴露模块缓存</span><br><span class="line">  __webpack_require__.c = installedModules;</span><br><span class="line">  // 定义getter函数</span><br><span class="line">  __webpack_require__.d = function(exports, name, getter) &#123;</span><br><span class="line">    if(!__webpack_require__.o(exports, name)) &#123;</span><br><span class="line">      Object.defineProperty(</span><br><span class="line">        exports,</span><br><span class="line">        name,</span><br><span class="line">        &#123; enumerable: true, get: getter &#125;</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  // 在导出中定义__esModule</span><br><span class="line">  __webpack_require__.r = function(exports) &#123;</span><br><span class="line">    if(typeof Symbol !== &apos;undefined&apos; &amp;&amp; Symbol.toStringTag) &#123;</span><br><span class="line">      Object.defineProperty(exports, Symbol.toStringTag, &#123; value: &apos;Module&apos; &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    Object.defineProperty(exports, &apos;__esModule&apos;, &#123; value: true &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  // 创建假的命名空间对象</span><br><span class="line">  // mode &amp; 1: value是模块id，通过它引入</span><br><span class="line">  // mode &amp; 2: 合并所有属性到ns对象上</span><br><span class="line">  // mode &amp; 4: ns已经存在时，直接返回</span><br><span class="line">  // mode &amp; 8|1: 行为和require一样</span><br><span class="line">  __webpack_require__.t = function(value, mode) &#123;</span><br><span class="line">    if(mode &amp; 1) value = __webpack_require__(value);</span><br><span class="line">    if(mode &amp; 8) return value;</span><br><span class="line">    if((mode &amp; 4) &amp;&amp; typeof value === &apos;object&apos; &amp;&amp; value &amp;&amp; value.__esModule) return value;</span><br><span class="line">    var ns = Object.create(null);</span><br><span class="line">    __webpack_require__.r(ns);</span><br><span class="line">    Object.defineProperty(ns, &apos;default&apos;, &#123; enumerable: true, value: value &#125;);</span><br><span class="line">    if(mode &amp; 2 &amp;&amp; typeof value != &apos;string&apos;)</span><br><span class="line">      for(var key in value)</span><br><span class="line">        __webpack_require__.d(ns, key, function(key) &#123;</span><br><span class="line">          return value[key];</span><br><span class="line">        &#125;.bind(null, key));</span><br><span class="line">    return ns;</span><br><span class="line">  &#125;;</span><br><span class="line">  // getDefaultExport function for compatibility with non-harmony modules</span><br><span class="line">  __webpack_require__.n = function(module) &#123;</span><br><span class="line">    var getter = module &amp;&amp; module.__esModule ?</span><br><span class="line">      function getDefault() &#123; return module[&apos;default&apos;]; &#125; :</span><br><span class="line">      function getModuleExports() &#123; return module; &#125;;</span><br><span class="line">    __webpack_require__.d(getter, &apos;a&apos;, getter);</span><br><span class="line">    return getter;</span><br><span class="line">  &#125;;</span><br><span class="line">  // Object.prototype.hasOwnProperty.call</span><br><span class="line">  __webpack_require__.o = function(object, property) &#123;</span><br><span class="line">      return Object.prototype.hasOwnProperty.call(object, property);</span><br><span class="line">  &#125;;</span><br><span class="line">  // __webpack_public_path__</span><br><span class="line">  __webpack_require__.p = &quot;&quot;;</span><br><span class="line">  // Load entry module and return exports</span><br><span class="line">  return __webpack_require__(__webpack_require__.s = &quot;./dom.js&quot;);</span><br><span class="line">&#125;)</span><br><span class="line">/************************************************************************/</span><br><span class="line">(&#123;</span><br><span class="line"></span><br><span class="line">/***/ &quot;./dom.js&quot;:</span><br><span class="line">/*!****************!*\</span><br><span class="line">  !*** ./dom.js ***!</span><br><span class="line">  \****************/</span><br><span class="line">/*! no static exports found */</span><br><span class="line">/***/ (function(module, exports, __webpack_require__) &#123;</span><br><span class="line"></span><br><span class="line">eval(`</span><br><span class="line">  var getUsers = __webpack_require__(/*! ./users */ \&quot;./users.js\&quot;).getUsers\n\n</span><br><span class="line">  function addUserToDOM(name) &#123;\n</span><br><span class="line">    const node = document.createElement(\&quot;li\&quot;)\n</span><br><span class="line">    const text = document.createTextNode(name)\n</span><br><span class="line">    node.appendChild(text)\n\n</span><br><span class="line">    document.getElementById(\&quot;users\&quot;)\n</span><br><span class="line">      .appendChild(node)\n&#125;\n\n</span><br><span class="line">    document.getElementById(\&quot;submit\&quot;)\n</span><br><span class="line">      .addEventListener(\&quot;click\&quot;, function() &#123;\n</span><br><span class="line">        var input = document.getElementById(\&quot;input\&quot;)\n</span><br><span class="line">        addUserToDOM(input.value)\n\n</span><br><span class="line">        input.value = \&quot;\&quot;\n&#125;)\n\n</span><br><span class="line">        var users = getUsers()\n</span><br><span class="line">        for (var i = 0; i &lt; users.length; i++) &#123;\n</span><br><span class="line">          addUserToDOM(users[i])\n</span><br><span class="line">        &#125;\n\n\n//# sourceURL=webpack:///./dom.js?`</span><br><span class="line">);&#125;),</span><br><span class="line"></span><br><span class="line">/***/ &quot;./users.js&quot;:</span><br><span class="line">/*!******************!*\</span><br><span class="line">  !*** ./users.js ***!</span><br><span class="line">  \******************/</span><br><span class="line">/*! no static exports found */</span><br><span class="line">/***/ (function(module, exports) &#123;</span><br><span class="line"></span><br><span class="line">eval(`</span><br><span class="line">  var users = [\&quot;Tyler\&quot;, \&quot;Sarah\&quot;, \&quot;Dan\&quot;]\n\n</span><br><span class="line">  function getUsers() &#123;\n</span><br><span class="line">    return users\n&#125;\n\nmodule.exports = &#123;\n</span><br><span class="line">      getUsers: getUsers\n</span><br><span class="line">    &#125;\n\n//# sourceURL=webpack:///./users.js?`);&#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>你可以注意到有很多奇奇怪怪的代码，你可以阅读注释来简单了解一下到底发生了什么。但是，一个很有趣的事是，打包后的代码用一个IIFE包裹起来了。也就是说，他们使用了IIFE模块模式得到了一个相对来说最完美的方案。</p>
<p>javascript的未来是一个活生生的，丰满的语言。TC-31标准委员会，一年内多次讨论如何潜在改善提高javascript语言。换言之，模块是编写可伸缩性、可维护的js代码的关键特性。在2013年甚至更早之前，这种说法很显然是不存在的。js需要一种模块的标准。一种内建的可处理模块的解决方法，这也拉开了实现js模块化的序幕。</p>
<p>如你现在所知道的。如果你之前接受过创建js系统模块的任务，这个模块最终看起来将是什么样的？commonjs？每个文件以一种很清晰的方式定义导入和导出，很显然，这个是重中之重。但是有个问题，commonjs加载模块是同步的。虽然这对服务端没有压力，但是对浏览器不是很友好。一个改变是让commonjs支持异步加载，另一种我们使用语言自己的模块化，也就是<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">这次，我们不需要再假想这种实现了，TC-39标准委员会提出了精确的设计和描述，也就是&quot;ES Modules&quot;。下面让我们以这种标准化的模块创建javascript模块。</span><br><span class="line"></span><br><span class="line">#### EM Modules</span><br><span class="line">正如上面所说的，为了指定你要导出的模块，你需要使用```export```关键字。</span><br><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">// utils.js</span><br><span class="line"></span><br><span class="line">// Not exported</span><br><span class="line">function once(fn, context) &#123;</span><br><span class="line">	var result</span><br><span class="line">	return function() &#123;</span><br><span class="line">		if(fn) &#123;</span><br><span class="line">			result = fn.apply(context || this, arguments)</span><br><span class="line">			fn = null</span><br><span class="line">		&#125;</span><br><span class="line">		return result</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Exported</span><br><span class="line">export function first (arr) &#123;</span><br><span class="line">  return arr[0]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Exported</span><br><span class="line">export function last (arr) &#123;</span><br><span class="line">  return arr[arr.length - 1]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>有几种方式可以导入<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">import * as utils from &apos;./utils&apos;</span><br><span class="line"></span><br><span class="line">utils.first([1,2,3]) // 1</span><br><span class="line">utils.last([1,2,3]) // 3</span><br></pre></td></tr></table></figure></p>
<p>如果我们不想导入全部导出呢？在这个例子中，如果你只想引入<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">import &#123; first &#125; from &apos;./utils&apos;</span><br><span class="line"></span><br><span class="line">first([1,2,3]) // 1</span><br></pre></td></tr></table></figure></p>
<p>还有呢，不仅仅可以指定多个导出，你还可以指定一个<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">// leftpad.js</span><br><span class="line"></span><br><span class="line">export default function leftpad (str, len, ch) &#123;</span><br><span class="line">  var pad = &apos;&apos;;</span><br><span class="line">  while (true) &#123;</span><br><span class="line">    if (len &amp; 1) pad += ch;</span><br><span class="line">    len &gt;&gt;= 1;</span><br><span class="line">    else break;</span><br><span class="line">  &#125;</span><br><span class="line">  return pad + str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>当你使用<figure class="highlight plain"><figcaption><span>name from './patn'```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">import leftpad from &apos;./leftpad&apos;</span><br></pre></td></tr></table></figure></p>
<p>现在，如果你有默认导出，也有其他格式的导出怎么办呢？这不是问题，按照正确的语法写就可以了，ES Module没有这种限制。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils.js</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">once</span>(<span class="params">fn, context</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> result</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(fn) &#123;</span><br><span class="line">			result = fn.apply(context || <span class="keyword">this</span>, <span class="built_in">arguments</span>)</span><br><span class="line">			fn = <span class="literal">null</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> result</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// regular export</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">first</span> (<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> arr[<span class="number">0</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// regular export</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">last</span> (<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> arr[arr.length - <span class="number">1</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// default export</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">leftpad</span> (<span class="params">str, len, ch</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> pad = <span class="string">''</span>;</span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (len &amp; <span class="number">1</span>) pad += ch;</span><br><span class="line">    len &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> pad + str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那导入语法看起来是什么样的？我觉得你可以想象得到。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> leftpad, &#123; first, last &#125; <span class="keyword">from</span> <span class="string">'./utils'</span></span><br></pre></td></tr></table></figure>

<p>还是挺爽的是吧？<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">ES Modules的关键点在于，它是js语言的一部分，并且现代浏览器已经支持这种写法了。现在，让我们回到一开始的app，不过这次我们使用ES Modules来改写一遍。</span><br><span class="line"></span><br><span class="line">[这里](https://github.com/tylermcginnis/modules/tree/esModules)查看所有源代码</span><br><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">// users.js</span><br><span class="line"></span><br><span class="line">var users = [&quot;Tyler&quot;, &quot;Sarah&quot;, &quot;Dan&quot;]</span><br><span class="line"></span><br><span class="line">export default function getUsers() &#123;</span><br><span class="line">  return users</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// dom.js</span><br><span class="line"></span><br><span class="line">import getUsers from &apos;./users.js&apos;</span><br><span class="line"></span><br><span class="line">function addUserToDOM(name) &#123;</span><br><span class="line">  const node = document.createElement(&quot;li&quot;)</span><br><span class="line">  const text = document.createTextNode(name)</span><br><span class="line">  node.appendChild(text)</span><br><span class="line"></span><br><span class="line">  document.getElementById(&quot;users&quot;)</span><br><span class="line">    .appendChild(node)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">document.getElementById(&quot;submit&quot;)</span><br><span class="line">  .addEventListener(&quot;click&quot;, function() &#123;</span><br><span class="line">    var input = document.getElementById(&quot;input&quot;)</span><br><span class="line">    addUserToDOM(input.value)</span><br><span class="line"></span><br><span class="line">    input.value = &quot;&quot;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">var users = getUsers()</span><br><span class="line">for (var i = 0; i &lt; users.length; i++) &#123;</span><br><span class="line">  addUserToDOM(users[i])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>使用IIFE模式，我们需要使用script引入每个js文件。使用commonjs，我们需要使用webpack等打包器处理我们的代码，然后引入打包后的文件。而ES Modules中，在一些现在浏览器中，我们仅仅需要使用script标签引入我们的未被处理过的入口文件，然后为script标签增加属性:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">```html</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;title&gt;Users&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line"></span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;h1&gt;Users&lt;/h1&gt;</span><br><span class="line">    &lt;ul id=&quot;users&quot;&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">    &lt;input id=&quot;input&quot; type=&quot;text&quot; placeholder=&quot;New User&quot;&gt;&lt;/input&gt;</span><br><span class="line">    &lt;button id=&quot;submit&quot;&gt;Submit&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">    &lt;script type=module src=&apos;dom.js&apos;&gt;&lt;/script&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<h4 id="死代码消除"><a href="#死代码消除" class="headerlink" title="死代码消除"></a>死代码消除</h4><p>到这里，还有一个commonjs与ES Modules的不同没有介绍。<br>commonjs中，你可以在任何地方引入模块，甚至通过判断。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (pastTheFold === <span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="built_in">require</span>(<span class="string">'./parallax'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ES Modules需要静态解析（参考js词法解析，也会有提升的效果）的，import语句必须在模块顶部，也就是说，他不能再判断语句中或者其他类似的语句中使用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (pastTheFold === <span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="keyword">import</span> <span class="string">'./parallax'</span> <span class="comment">// "import' and 'export' may only appear at the top level"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这是因为加载器会进行模块树的静态解析。找到那些真正被用到的，丢弃那些未被使用到的。这是一个很大的话题。换句话说，这也是为什么ES Modules希望你声明import语句在模块顶部，这样打包器会更快的解析的你依赖树，解析完毕，他才会去真正的工作。</p>
<p>对了，其实你可以使用<code>import()</code>来动态导入。请自行查找。</p>
<p>希望通过这篇文章可以帮到你。</p>
<p><a href="https://tylermcginnis.com/javascript-modules-iifes-commonjs-esmodules/" target="_blank" rel="noopener">原文链接</a></p>
<hr>
<ul>
<li>script标签上加上<code>type=&#39;module&#39;</code>的加载模式都是<code>defer</code>。</li>
<li>IIFE：匿名函数</li>
<li>AMD：依赖前置异步模块加载</li>
<li>CMD：就近依赖异步模块加载</li>
<li>commonjs(cjs)：服务端通用的模块加载</li>
<li>UMD：不是单独的标准，是IIFE、AMD(CMD)、commonjs的结合。</li>
<li>es：js自己的模块打包</li>
</ul>
<table>
<thead>
<tr>
<th>标准</th>
<th>变量问题</th>
<th>依赖</th>
<th>动态/懒 加载</th>
<th>静态分析</th>
</tr>
</thead>
<tbody><tr>
<td>IIFE</td>
<td>✔</td>
<td>×</td>
<td>×</td>
<td>×</td>
</tr>
<tr>
<td>AMD</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>×</td>
</tr>
<tr>
<td>CMD</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>×</td>
</tr>
<tr>
<td>commonjs</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>×</td>
</tr>
<tr>
<td>es6</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
</tr>
</tbody></table>
<p>再强调一点：es6的模块是值的引用，commonjs是值的拷贝。<a href="https://zhuanlan.zhihu.com/p/33843378" target="_blank" rel="noopener">参考文章</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/memory/2021/05/09/koaMiddles/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FoxDaxian">
      <meta itemprop="description" content="遇到好玩的，稀奇的，新鲜的，记录下来，分享出去。">
      <meta itemprop="image" content="/memory/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fox的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/memory/2021/05/09/koaMiddles/" class="post-title-link" itemprop="url">koa 中间件原理</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2021-05-09 23:37:00" itemprop="dateCreated datePublished" datetime="2021-05-09T23:37:00+00:00">2021-05-09</time>
            </span>
          

          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/memory/categories/源码分析/" itemprop="url" rel="index"><span itemprop="name">源码分析</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = compose;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">compose</span>(<span class="params">middleware</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">Array</span>.isArray(middleware))</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'Middleware stack must be an array!'</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> fn <span class="keyword">of</span> middleware) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> fn !== <span class="string">'function'</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'Middleware must be composed of functions!'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">context, next</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> index = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">return</span> dispatch(<span class="number">0</span>);</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">dispatch</span>(<span class="params">i</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (i &lt;= index)</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(</span><br><span class="line">                    <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'next() called multiple times'</span>)</span><br><span class="line">                );</span><br><span class="line">            index = i;</span><br><span class="line">            <span class="keyword">let</span> fn = middleware[i];</span><br><span class="line">            <span class="keyword">if</span> (i === middleware.length) fn = next;</span><br><span class="line">            <span class="keyword">if</span> (!fn) <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(fn(context, dispatch.bind(<span class="literal">null</span>, i + <span class="number">1</span>)));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(err);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="代码很短，咱们直接分析："><a href="#代码很短，咱们直接分析：" class="headerlink" title="代码很短，咱们直接分析："></a>代码很短，咱们直接分析：</h3><ul>
<li>本身是一个高阶函数，返回一个函数</li>
<li>compose函数接收一个数组形式middleware的参数，如果不为数组或者数组中有非函数的项，抛出异常</li>
<li>返回的函数接收koa上下文环境参数 - ctx 和  下一个middleware， 不管怎样，该函数返回一个promise对象。以供之后进行下一步异步操作</li>
</ul>
<h3 id="分下compose返回的函数"><a href="#分下compose返回的函数" class="headerlink" title="分下compose返回的函数"></a>分下compose返回的函数</h3><ul>
<li>初始化index，用户判断是否多次调用next，因为每调用一次next，都会是i + 1，而 index 只会同步为 i 一次</li>
<li>包含一个递归的dispatch函数，接收当前要执行的middle的索引，默认从0开始</li>
<li>之后获取当前要执行的middleware</li>
<li>如果为middleware的长度那么说明无可执行的middleware（因为数组的长度比真实的项索引多1），重新赋值为next（手动设置最后一个中间件）</li>
<li>如果fn为空，return promise</li>
<li>try cache 执行的fn，并将fn的返回值作为promise的成功结果，dispatch.bind(null, next middleow) 为next，当你调用next的时候即调用下一个</li>
<li>捕获错误，返回err</li>
</ul>
<p>koa中间件是一个可选的、灵活的，不一定要执行完所有的中间件，你可以只执行某几个，中间件可以操作ctx上的所有数据，可以通过koa中的respond处理ctx的相关属性，来进行数据展示等操作</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/memory/2021/05/09/lerna/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FoxDaxian">
      <meta itemprop="description" content="遇到好玩的，稀奇的，新鲜的，记录下来，分享出去。">
      <meta itemprop="image" content="/memory/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fox的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/memory/2021/05/09/lerna/" class="post-title-link" itemprop="url">使用lerna管理你的项目</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2021-05-09 23:37:00" itemprop="dateCreated datePublished" datetime="2021-05-09T23:37:00+00:00">2021-05-09</time>
            </span>
          

          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/memory/categories/介绍/" itemprop="url" rel="index"><span itemprop="name">介绍</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>有段时间没更新博客了，是时候更新一波了。<br>之前不是vue-next出了吗，然后就去学习了一下，发现整个目录不是那么熟悉了，变成这样了:</p>
<p><img src="https://raw.githubusercontent.com/FoxDaxian/FoxDaxian.github.io/master/assets/picgo/20191201163148.png" alt></p>
<p>于是就这个线索去研究了一下，发下这是用的 lerna + yarn 的架构，不仅vue，包括jest，babel等都是用的这类架构，他们有相同的前缀，比如@babel/xxx，不过这个前缀(scope)是需要付费的。</p>
<p>lerna有什么优点呢？</p>
<ul>
<li>分离一个大型的codebase到多个小的孤立或者公共的repo</li>
<li>可以统一管理版本号，一键发布,自动生成changelog(<a href="https://github.com/lerna/lerna/blob/master/commands/publish#readme" target="_blank" rel="noopener">lerna publish</a>)</li>
<li>一键安装依赖，包括link(<a href="https://github.com/lerna/lerna/blob/master/commands/bootstrap#readme" target="_blank" rel="noopener">lerna bootstrap</a>)</li>
<li>目录清晰，像上面vue-next那样。</li>
</ul>
<div style="align: center">
<img src="https://raw.githubusercontent.com/FoxDaxian/FoxDaxian.github.io/master/assets/picgo/20191201163946.jpg">
</div>


<hr>
<p>所以说！</p>
<div style="align: center">
<img src="https://raw.githubusercontent.com/FoxDaxian/FoxDaxian.github.io/master/assets/picgo/20191201164414.jpg">
</div>


<h3 id="开整！！！"><a href="#开整！！！" class="headerlink" title="开整！！！"></a>开整！！！</h3><p>首先使用lerna + yarn来管理我们的npm工作区：<br>所以创建一个空的reop，然后<code>npx lerna init</code>初始化lerna项目，然后左改改右改改，像下面这样，意思是说用yarn替代lerna的工作区定义，然后pkg中指定workspaces，指定private和root，表明别发布我。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// lerna.js</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"version"</span>: <span class="string">"independent"</span>,</span><br><span class="line">    <span class="string">"npmClient"</span>: <span class="string">"yarn"</span>,</span><br><span class="line">    <span class="string">"useWorkspaces"</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"root"</span>,</span><br><span class="line">    <span class="string">"private"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"workspaces"</span>: [</span><br><span class="line">        <span class="string">"packages/*"</span>,</span><br><span class="line">        <span class="string">"demo"</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<div style="align: center">
<img src="https://raw.githubusercontent.com/FoxDaxian/FoxDaxian.github.io/master/assets/picgo/20191201165050.png">
</div>

<p>哈哈哈哈，开个玩笑，不过lerna的初始工作就好了，剩下的就是安装依赖啊，写代码啊，发布啊。用指令表示就是：</p>
<ul>
<li>lerna bootstrap(或者增加postinstall hooks自动执行)</li>
<li>写代码</li>
<li>lerna version 指定版本</li>
<li>lerna publish (前需要登录npm，例如: npm login)</li>
</ul>
<p>不过，仅仅只有上面这些肯定是不够的，我们还需要增加：</p>
<ul>
<li>本地预览</li>
<li>本地unit测试</li>
<li>一些自动化脚本</li>
<li>格式化检查工具</li>
<li>其他(ts、commitlint、<a href="https://github.com/commitizen/cz-cli" target="_blank" rel="noopener">cz</a>)</li>
</ul>
<p>这块就不啰嗦了，直接丢一个<a href="https://github.com/FoxDaxian/oneForAll" target="_blank" rel="noopener">repo: oneForAll</a>供大家参考，欢迎交流哈。<br>目录如下:</p>
<p><img src="https://raw.githubusercontent.com/FoxDaxian/FoxDaxian.github.io/master/assets/picgo/20191201165826.png" alt></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/memory/2021/05/09/pke/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FoxDaxian">
      <meta itemprop="description" content="遇到好玩的，稀奇的，新鲜的，记录下来，分享出去。">
      <meta itemprop="image" content="/memory/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fox的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/memory/2021/05/09/pke/" class="post-title-link" itemprop="url">package.json 中的字段</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2021-05-09 23:37:00" itemprop="dateCreated datePublished" datetime="2021-05-09T23:37:00+00:00">2021-05-09</time>
            </span>
          

          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/memory/categories/介绍/" itemprop="url" rel="index"><span itemprop="name">介绍</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>workspace<br>将一个大型工程进行模块化，根据单一职责，方便日后的维护，但是这种方法不受用与所有工程，比如一些工程需要将所有仓库放到一个统一的存储库中，方便协作共建维护。这就派生出了 monorepos，对应的方法就是 yarn 的 workspace 或者 lerna，它能够帮你节约每次 cd + install or upgrade 的时间，更方便管理。<br><a href="https://yarnpkg.com/blog/2017/08/02/introducing-workspaces/" target="_blank" rel="noopener">yarn</a><br><a href="https://hateonion.me/posts/b2b0/" target="_blank" rel="noopener">中文</a></li>
<li>resolutions<br>强制指定子依赖的版本，防止升级后导致多个版本并存，打包后内容大<br><a href="https://yarnpkg.com/lang/en/docs/selective-version-resolutions/" target="_blank" rel="noopener">yarn</a><br><a href="https://juffalow.com/javascript/how-yarn-resolutions-can-save-you" target="_blank" rel="noopener">demo</a><br><a href="https://blog.hakurouken.me/2018/08/05/yarn-versions/" target="_blank" rel="noopener">中文</a></li>
<li>private<br>如果为 true，那么 npm 将拒绝发布它，用来防止私人存储库意外发布的一种方法</li>
<li>engines<br>指定项目运行的node版本范围</li>
<li></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/memory/2021/05/09/proto/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FoxDaxian">
      <meta itemprop="description" content="遇到好玩的，稀奇的，新鲜的，记录下来，分享出去。">
      <meta itemprop="image" content="/memory/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fox的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/memory/2021/05/09/proto/" class="post-title-link" itemprop="url">Object.assign引发的问题</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2021-05-09 23:37:00" itemprop="dateCreated datePublished" datetime="2021-05-09T23:37:00+00:00">2021-05-09</time>
            </span>
          

          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/memory/categories/原理浅析/" itemprop="url" rel="index"><span itemprop="name">原理浅析</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="缘由"><a href="#缘由" class="headerlink" title="缘由"></a>缘由</h3><p>今天看到一段代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="built_in">Object</span>.assign(func1, func2);</span><br></pre></td></tr></table></figure>

<p>心生疑惑，为什么 Object.assign 的参数可以是函数？<br>于是有了下面这一堆东西，其实都是老生常谈的东西，可能是岁数大了吧，有些片段都快丢失了，哈哈</p>
<h3 id="prototype"><a href="#prototype" class="headerlink" title="prototype"></a>prototype</h3><p>js 中 万物皆是对象！！！</p>
<p><strong>proto</strong>（隐式原型）与 prototype（显式原型）<br>对象具有属性<strong>proto</strong>，可称为隐式原型<br>实例(对象)的 <strong>proto</strong> === 构造(该实例)函数的 prototype<br>函数 Function 是特殊的对象，除了有<strong>proto</strong>外，还有自己的特有的属性 - 原型对象(prototype)<br>原型对象有一个属性 - constructor，指回 x.prototype 的 x(原函数)</p>
<p>所以 函数 还是 构造函数的函数(Function)都会指回 Object</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 特例</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">aa</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">aa.prototype; <span class="comment">// =&gt; &#123;constructor: ƒ&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Function</span>.prototype; <span class="comment">// =&gt; ƒ () &#123; [native code] &#125; 函数也是对象哦</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 所以</span></span><br><span class="line"><span class="built_in">Function</span>.prototype.constructor; <span class="comment">// =&gt; ƒ Function() &#123; [native code] &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Function</span>.prototype.constructor === <span class="built_in">Function</span>; <span class="comment">// =&gt; true</span></span><br></pre></td></tr></table></figure>

<p>Object.prototype 是 原型的尽头，在往上就是 null 了</p>
<p>看张老图吧</p>
<p><img src="https://raw.githubusercontent.com/FoxDaxian/FoxDaxian.github.io/master/assets/picgo/20191010200746.jpg" alt></p>
<h3 id="Objecg-assign"><a href="#Objecg-assign" class="headerlink" title="Objecg.assign"></a>Objecg.assign</h3><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><p>Object.assign 方法只会拷贝源对象自身的并且可枚举的属性到目标对象</p>
<p>分为两个关键点 源对象自身且可枚举的属性 和 目标对象，一个个解释</p>
<h5 id="枚举"><a href="#枚举" class="headerlink" title="枚举"></a>枚举</h5><p>判断是否为枚举属性: Object.propertyIsEnumerable(prop)<br>如果判断的属性存在于 Object 对象的原型内，不管它是否可枚举都会返回 false。</p>
<p>总的来说，不管什么类型，只要可以用 for…in 遍历出来的属性，全都可以拷贝到 <strong>对象</strong> 上</p>
<p>例如 string 和 number：<br><img src="https://raw.githubusercontent.com/FoxDaxian/FoxDaxian.github.io/master/assets/picgo/20191010200634.png" alt></p>
<h5 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h5><p>所说的对象是哪些呢？通过 instanlceof 可知(不包含全部类型)</p>
<p><img src="https://raw.githubusercontent.com/FoxDaxian/FoxDaxian.github.io/master/assets/picgo/20191010194627.png" alt></p>
<p>上面是前提，下面让我们看一个 demo 吧：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="built_in">console</span>.log(fn[<span class="number">0</span>], fn[<span class="number">1</span>], fn[<span class="number">2</span>]); <span class="comment">// =&gt; undefined undefined undefined</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> str = <span class="string">"963"</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">in</span> str) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;k&#125;</span>: <span class="subst">$&#123;str[k]&#125;</span>`</span>); <span class="comment">// =&gt; 0: 9</span></span><br><span class="line">  <span class="comment">// =&gt; 1: 6</span></span><br><span class="line">  <span class="comment">// =&gt; 2: 3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.assign(fn, <span class="string">"963"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(fn[<span class="number">0</span>], fn[<span class="number">1</span>], fn[<span class="number">2</span>]); <span class="comment">// =&gt; 9 6 3</span></span><br></pre></td></tr></table></figure>

<p>结果如下:<br><img src="https://raw.githubusercontent.com/FoxDaxian/FoxDaxian.github.io/master/assets/picgo/20191010201232.png" alt></p>
<p><a href="https://github.com/creeperyang/blog/issues/9" target="_blank" rel="noopener">深入讲解<strong>proto</strong> 和 prototype</a><br><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Enumerability_and_ownership_of_properties" target="_blank" rel="noopener">属性的可枚举型</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/memory/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/memory/">1</a><span class="page-number current">2</span><a class="page-number" href="/memory/page/3/">3</a><a class="page-number" href="/memory/page/4/">4</a><a class="extend next" rel="next" href="/memory/page/3/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">FoxDaxian</p>
              <div class="site-description motion-element" itemprop="description">遇到好玩的，稀奇的，新鲜的，记录下来，分享出去。</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/memory/archives/">
                
                    <span class="site-state-item-count">40</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">11</span>
                    <span class="site-state-item-name">categories</span>
                  
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">4</span>
                    <span class="site-state-item-name">tags</span>
                  
                </div>
              
            </nav>
          

          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">FoxDaxian</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.2.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/memory/lib/jquery/index.js?v=3.4.1"></script>

  
  <script src="/memory/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/memory/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/memory/js/utils.js?v=7.2.0"></script>

  <script src="/memory/js/motion.js?v=7.2.0"></script>



  
  


  <script src="/memory/js/schemes/muse.js?v=7.2.0"></script>



  

  


  <script src="/memory/js/next-boot.js?v=7.2.0"></script>


  

  

  

  



  




  

  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
