<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">






















<link rel="stylesheet" href="/memory/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">

<link rel="stylesheet" href="/memory/css/main.css?v=7.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/memory/images/apple-touch-icon-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/memory/images/favicon-32x32-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/memory/images/favicon-16x16-next.png?v=7.2.0">


  <link rel="mask-icon" href="/memory/images/logo.svg?v=7.2.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/memory/',
    scheme: 'Muse',
    version: '7.2.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="遇到好玩的，稀奇的，新鲜的，记录下来，分享出去。">
<meta name="keywords" content="博客 分享">
<meta property="og:type" content="website">
<meta property="og:title" content="fox的博客">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="fox的博客">
<meta property="og:description" content="遇到好玩的，稀奇的，新鲜的，记录下来，分享出去。">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="fox的博客">
<meta name="twitter:description" content="遇到好玩的，稀奇的，新鲜的，记录下来，分享出去。">





  
  
  <link rel="canonical" href="http://yoursite.com/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>fox的博客</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/memory/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">fox的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">github地址 -> https://github.com/FoxDaxian</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
      
    

    

    <a href="/memory/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
      
    

    

    <a href="/memory/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/memory/2021/05/09/proxy/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FoxDaxian">
      <meta itemprop="description" content="遇到好玩的，稀奇的，新鲜的，记录下来，分享出去。">
      <meta itemprop="image" content="/memory/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fox的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/memory/2021/05/09/proxy/" class="post-title-link" itemprop="url">proxy简析</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2021-05-09 23:37:00" itemprop="dateCreated datePublished" datetime="2021-05-09T23:37:00+00:00">2021-05-09</time>
            </span>
          

          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/memory/categories/原理/" itemprop="url" rel="index"><span itemprop="name">原理</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Proxy"><a href="#Proxy" class="headerlink" title="Proxy"></a>Proxy</h1><p>使用proxy，你可以把老虎伪装成猫的外表，这有几个例子，希望能让你感受到proxy的威力。<br>proxy 用来定义自定义的基本操作行为，比如查找、赋值、枚举性、函数调用等。</p>
<p>proxy接受一个待代理目标对象和一些包含元操作的对象，为待代理目标创建一个‘屏障’，并拦截所有操作，重定向到自定义的元操作对象上。</p>
<p>proxy通过<figure class="highlight plain"><figcaption><span>Proxy```来创建，接受两个参数：</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">1. 待代理目标对象</span><br><span class="line">2. 元操作对象</span><br><span class="line"></span><br><span class="line">闲话少说，直接看例子。</span><br><span class="line"></span><br><span class="line">#### 最简单的只代理一个方功能，在这个例子里，我们让```get```操作，永远返回一个固定的值</span><br><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">let target = &#123;</span><br><span class="line">  name: &apos;fox&apos;,</span><br><span class="line">  age: 23</span><br><span class="line">&#125;</span><br><span class="line">let handler = &#123;</span><br><span class="line">  get: (obj, k) =&gt; 233</span><br><span class="line">&#125;</span><br><span class="line">target = new Proxy(target, handler);</span><br><span class="line">target.a // 233</span><br><span class="line">target.b // 233</span><br><span class="line">target.c // 233</span><br></pre></td></tr></table></figure></p>
<p>无论你<figure class="highlight plain"><figcaption><span>'x')```都会返回233</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">当然，代理```get```仅仅是其中一种操作，还有：</span><br><span class="line">    - [get](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/get)</span><br><span class="line">    - [set](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/set)</span><br><span class="line">    - [has](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/has)</span><br><span class="line">    - [apply](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/apply)</span><br><span class="line">    - [construct](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/construct)</span><br><span class="line">    - [ownKeys](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/ownKeys)</span><br><span class="line">    - [deleteProperty](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/deleteProperty)</span><br><span class="line">    - [defineProperty](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/defineProperty)</span><br><span class="line">    - [isExtensible](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/isExtensible)</span><br><span class="line">    - [preventExtensions](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/preventExtensions)</span><br><span class="line">    - [getPrototypeOf](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/getPrototypeOf)</span><br><span class="line">    - [setPrototypeOf](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/setPrototypeOf)</span><br><span class="line">    - [getOwnPropertyDescriptor](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/getOwnPropertyDescriptor)</span><br><span class="line"></span><br><span class="line">#### 改变默认值为0</span><br><span class="line">在其他语言中，如果访问对象中没有的属性，默认会返回0，这在某些场景下很有用，很方便，比如坐标系，一般来说z轴默认是0.</span><br><span class="line">但是在js中，对象中不存在的key的默认值是undefined，而不是合法的初始值。</span><br><span class="line">不过可以使用proxy解决这个问题</span><br><span class="line">```javascript</span><br><span class="line">const defaultValueObj = (target, defaultValue) =&gt; new Proxy(target, &#123;</span><br><span class="line">  get: (obj, k) =&gt; Reflect.has(obj, k) ? obj[k] : defaultValue</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>建议根据不同类型返回不同的默认值，Number =&gt; 0 String =&gt; ‘’ Object =&gt; {} Array =&gt; []等等</p>
<h4 id="数组负索引取值"><a href="#数组负索引取值" class="headerlink" title="数组负索引取值"></a>数组负索引取值</h4><p>js中，获取数组的最后一个元素是相对麻烦的，容易出错的。这就是为什么TC39提案定义一个方便的属性，<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">其他语言比如python，和ruby提供了访问数组最后一个元素的方法，例如使用arr[-1]代替arr[arr.length - 1]</span><br><span class="line">不过，我们有proxy，负索引在js中也可以实现。</span><br><span class="line">```javascript</span><br><span class="line">const negativeArray = els =&gt; new Proxy(els, &#123;</span><br><span class="line">  get: (target, k) =&gt; Reflect.get(target, +k &lt; 0 ? String(target.length + +k) : k)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>需要注意的一点是，get操作会字符串化所有的操作，所以我们需要转换成number在进行操作，<br>这个运用也是<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 隐藏属性</span><br><span class="line">js未能实现私有属性，尽管之后引入了```Symbol```去设置独一无二的属性，但是这个被后来的```Object.getOwnPropertySumbols```淡化了</span><br><span class="line">长期以来，人们使用下划线_来表示属性的私有，这意味着不运行外部操作该属性。不过，proxy提供了一种更好的方法来实现类似的私有属性</span><br><span class="line">```javascript</span><br><span class="line">const enablePrivate = (target, prefix = &apos;_&apos;) =&gt; new Proxy(target, &#123;</span><br><span class="line">  has: (obj, k) =&gt; (!k.startsWith(prefix) &amp;&amp; k in obj),</span><br><span class="line">  ownKeys: (obj, k) =&gt; Reflece.ownKeys(obj).filter(k =&gt; (typeof k !== &apos;string&apos; || !k.startsWith(prefix))),</span><br><span class="line">  get: (obj, k, rec) =&gt; (k in rec) ? obj[k] : undefined</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>结果</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> userData = enablePrivate(&#123;</span><br><span class="line">  firstName: <span class="string">'Tom'</span>,</span><br><span class="line">  mediumHandle: <span class="string">'@tbarrasso'</span>,</span><br><span class="line">  _favoriteRapper: <span class="string">'Drake'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">userData._favoriteRapper        <span class="comment">// undefined</span></span><br><span class="line">(<span class="string">'_favoriteRapper'</span> <span class="keyword">in</span> userData) <span class="comment">// false</span></span><br><span class="line"><span class="built_in">Object</span>.keys(userData)           <span class="comment">// ['firstName', 'mediumHandle']</span></span><br></pre></td></tr></table></figure>

<p>如果你打印该proxy代理对象，会在控制台看到，不过无所谓。</p>
<h4 id="缓存失效"><a href="#缓存失效" class="headerlink" title="缓存失效"></a>缓存失效</h4><p>服务端和客户端同步一个状态可能会出现问题，这很常见，在整个操作周期内，数据都有可能被改变，并且很难去掌握需要重新同步的时机。<br>proxy提供了一种新的办法，可以让属性在必要的时候失效，所有的访问操作，都会被检查判断，是否返回缓存还是进行其他行为的响应。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> timeExpired = <span class="function">(<span class="params">target, ttl = <span class="number">60</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> created_at = <span class="built_in">Date</span>.now();</span><br><span class="line">  <span class="keyword">const</span> isExpired = <span class="function"><span class="params">()</span> =&gt;</span> (<span class="built_in">Date</span>.now - created_at) &gt; ttl * <span class="number">1000</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Proxy</span>(tarvet, &#123;</span><br><span class="line">    <span class="keyword">get</span>: (target, k) =&gt; isExpired() ? undefined : Reflect.<span class="keyword">get</span>(target, k);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的功能很简单，他在一定时间内正常返回访问的属性，当超出ttl时间后，会返回undefined。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> timeExpired = ephemeral(&#123;</span><br><span class="line">  balance: <span class="number">14.93</span></span><br><span class="line">&#125;, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(bankAccount.balance)    <span class="comment">// 14.93</span></span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(bankAccount.balance)  <span class="comment">// undefined</span></span><br><span class="line">&#125;, <span class="number">10</span> * <span class="number">1000</span>)</span><br></pre></td></tr></table></figure>

<p>上面的例子会输出undefined在十秒后，更多的骚操作还请自行斟酌。</p>
<h4 id="只读"><a href="#只读" class="headerlink" title="只读"></a>只读</h4><p>尽管<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">```javascript</span><br><span class="line">const nope = () =&gt; &#123;</span><br><span class="line">  throw new Error(&apos;不能改变只读属性&apos;)</span><br><span class="line">&#125;</span><br><span class="line">const read_only = (obj) =&gt; new Proxy(obj, &#123;</span><br><span class="line">  set: nope,</span><br><span class="line">  defineProperty: nope,</span><br><span class="line">  deleteProperty: nope,</span><br><span class="line">  preentExtensions: nope,</span><br><span class="line">  setPrototypeOf: nope</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h4 id="枚举"><a href="#枚举" class="headerlink" title="枚举"></a>枚举</h4><p>结合上面的只读方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> createEnum = <span class="function">(<span class="params">target</span>) =&gt;</span> read_only(<span class="keyword">new</span> <span class="built_in">Proxy</span>(target, &#123;</span><br><span class="line">  <span class="keyword">get</span>: (obj, k) = &#123;</span><br><span class="line">    <span class="keyword">if</span> (k <span class="keyword">in</span> obj) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Reflect</span>.get(obj, k)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">ReferenceError</span>(<span class="string">`找不到属性<span class="subst">$&#123;k&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure>

<p>我们得到了一个对象，如果你访问不存在的属性，不会得到undefined，而是抛出一个指向异常错误，折让调试变得更方便。<br>这也是一个代理代理的例子，需要保证被代理的代理是一个合法的代理对象，这个有助于混合一些复杂的功能。</p>
<h4 id="重载操作符"><a href="#重载操作符" class="headerlink" title="重载操作符"></a>重载操作符</h4><p>最神奇的可能就是重载某些操作符了，比如使用<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">in用来判断指定的属性是否指定对象或者对象的原型链上，这种行为可以很优雅的被重载，比如创建一个用于判断目标数字是否在制定范围内的代理</span><br><span class="line">```javascript</span><br><span class="line">const range = (min, max) =&gt; new Proxy(Object.create(null), &#123;</span><br><span class="line">  has: (obj, k) =&gt; (+k &gt; min &amp;&amp; +k &lt; max)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> X = <span class="number">10.5</span></span><br><span class="line"><span class="keyword">const</span> nums = [<span class="number">1</span>, <span class="number">5</span>, X, <span class="number">50</span>, <span class="number">100</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (X <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">100</span>)) &#123; <span class="comment">// true</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">nums.filter(<span class="function"><span class="params">n</span> =&gt;</span> n <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">10</span>)) <span class="comment">// [1, 5]</span></span><br></pre></td></tr></table></figure>

<p>上面的例子，虽然不是什么复杂的操作，也没有解决什么复杂的问题，但是这种清晰，可读，可复用的方式相信也是值得推崇的。<br>当然除了in操作符，还有delete 和 new;</p>
<h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><ul>
<li>兼容性一般，不过谷歌开发的<a href="https://github.com/GoogleChrome/proxy-polyfill" target="_blank" rel="noopener">proxy-polyfill</a>目前已经支持get、set、apply、construct到ie9了</li>
<li>目前浏览器没有办法判断对象是否被代理，不过在node版本10以上，可以使用<code>util.types.isProxy</code>来判断</li>
<li>proxy的第一个参数必须是对象，不能代理原始值</li>
<li>性能，proxy的一个缺点就是性能，但是这个也因人/浏览器而异，不过，proxy绝对不适合用在性能关键点的代码上，当然，你可以衡量proxy带来的遍历和可能损耗的性能，进行合理的中和，来达到最佳的开发体验和用户体验</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/memory/2021/05/09/aboutMargin/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FoxDaxian">
      <meta itemprop="description" content="遇到好玩的，稀奇的，新鲜的，记录下来，分享出去。">
      <meta itemprop="image" content="/memory/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fox的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/memory/2021/05/09/aboutMargin/" class="post-title-link" itemprop="url">为什么margin：auto会居中?</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2021-05-09 23:37:00" itemprop="dateCreated datePublished" datetime="2021-05-09T23:37:00+00:00">2021-05-09</time>
            </span>
          

          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/memory/categories/原理/" itemprop="url" rel="index"><span itemprop="name">原理</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="根本原因"><a href="#根本原因" class="headerlink" title="根本原因"></a>根本原因</h4><p>auto值的计算是基于可用空间的，也就是只有块级非替换元素才会有剩余空间，这也就解释了为什么有些行内元素使用position:absolute;也会居中，因为absolute和float会悄悄的把元素编成block元素呀</p>
<p>如果是块级元素，他会填充父级所有的可用空间，如图：</p>
<p><img src="https://foxdaxian.github.io/assets/05_qunaer/block.png" alt="gif"></p>
<p>如果是替换元素的话，就不会产生这样的效果，如图：<br><img src="https://foxdaxian.github.io/assets/05_qunaer/img.png" alt="gif"></p>
<p>大概的原理是，如果块级非内联元素定位为非当前内容流，比如absolute，那么该元素不会和普通内容流一起渲染，如果设置</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">x</span>&#123;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那么该元素会填充父级所有的可用空间，当然他没有<code>width</code>、<code>height</code>优先级高，所以没有宽高会充满，有宽高会水平垂直居中</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/memory/2021/05/09/autoformat/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FoxDaxian">
      <meta itemprop="description" content="遇到好玩的，稀奇的，新鲜的，记录下来，分享出去。">
      <meta itemprop="image" content="/memory/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fox的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/memory/2021/05/09/autoformat/" class="post-title-link" itemprop="url">根据eslint自动格式化</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2021-05-09 23:37:00" itemprop="dateCreated datePublished" datetime="2021-05-09T23:37:00+00:00">2021-05-09</time>
            </span>
          

          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/memory/categories/效率/" itemprop="url" rel="index"><span itemprop="name">效率</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="prettier-eslint"><a href="#prettier-eslint" class="headerlink" title="prettier + eslint"></a>prettier + eslint</h1><ol>
<li>重置 vscode 的配置，采用.prettierrc 文件</li>
<li>编写 eslint 规则和.eslintignore</li>
<li>添加 package.json 的 lint 相关的命令</li>
<li>增加 prettier-eslint-cli，配置 format 命令</li>
<li>集成所有命令</li>
</ol>
<h3 id="prettier-eslin-优先读取-eslint-的配置，如果被禁用那么去读-prettierrc"><a href="#prettier-eslin-优先读取-eslint-的配置，如果被禁用那么去读-prettierrc" class="headerlink" title="prettier-eslin 优先读取 eslint 的配置，如果被禁用那么去读 .prettierrc"></a>prettier-eslin 优先读取 eslint 的配置，如果被禁用那么去读 .prettierrc</h3><h3 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .prettierrc</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"trailingComma"</span>: <span class="string">"none"</span>,</span><br><span class="line">    <span class="string">"tabWidth"</span>: <span class="number">4</span>,</span><br><span class="line">    <span class="string">"semi"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"singleQuote"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"jsxSingleQuote"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"bracketSpacing"</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"lint"</span>: <span class="string">"./node_modules/.bin/eslint ."</span>,</span><br><span class="line">    <span class="string">"format"</span>: <span class="string">"./node_modules/.bin/prettier-eslint --write \"utils/**/*.js\" \"components/**/*.?(vue|js)\""</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">"husky"</span>: &#123;</span><br><span class="line">    <span class="string">"hooks"</span>: &#123;</span><br><span class="line">        <span class="string">"pre-commit"</span>: <span class="string">"npm run format &amp;&amp; git add ."</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://gist.github.com/rswanderer/29dc65efc421b3b5b0442f1bd3dcd046" target="_blank" rel="noopener">eslint 配置文件参数说明</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/memory/2021/05/09/wxShare/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FoxDaxian">
      <meta itemprop="description" content="遇到好玩的，稀奇的，新鲜的，记录下来，分享出去。">
      <meta itemprop="image" content="/memory/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fox的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/memory/2021/05/09/wxShare/" class="post-title-link" itemprop="url">微信分享功能实战</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2021-05-09 23:37:00" itemprop="dateCreated datePublished" datetime="2021-05-09T23:37:00+00:00">2021-05-09</time>
            </span>
          

          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/memory/categories/原理/" itemprop="url" rel="index"><span itemprop="name">原理</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ol>
<li>引入wx的npm（weixin-js-sdk）包</li>
<li>判断是否为微信或qq环境</li>
<li>接口请求微信配置相关参数，注意接口传入的参数须和当前分享页的地址相同（不包括#以及后面的）</li>
<li>配置需要的微信jsapi相关信息</li>
<li>wx.ready =&gt; wx.checkJsApi 检查api可行性</li>
<li>判断并调用wx<a href="配置内容">相关方法</a></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> wx <span class="keyword">from</span> <span class="string">'weixin-js-sdk'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (&#123;分享配置参数&#125; = &#123;&#125;) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (weixin || qq) &#123;</span><br><span class="line">        getWxConfApi.then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> wxApiData = &#123;</span><br><span class="line">                forFriend: <span class="string">'updateAppMessageShareData'</span>,</span><br><span class="line">                forGroup: <span class="string">'updateTimelineShareData'</span></span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">const</span> wxApi = <span class="built_in">Object</span>.values(wxApiData);</span><br><span class="line">            wx.config(&#123;</span><br><span class="line">                debug: process.env.NODE_ENV === <span class="string">'development'</span>,</span><br><span class="line">                appId, <span class="comment">// 必填，公众号的唯一标识</span></span><br><span class="line">                timestamp, <span class="comment">// 必填，生成签名的时间戳</span></span><br><span class="line">                nonceStr, <span class="comment">// 必填，生成签名的随机串</span></span><br><span class="line">                signature, <span class="comment">// 必填，签名</span></span><br><span class="line">                jsApiList: wxApi <span class="comment">// 必填，需要使用的JS接口列表</span></span><br><span class="line">            &#125;);</span><br><span class="line">            wx.ready(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                wx.checkJsApi(&#123;</span><br><span class="line">                    jsApiList: wxApi,</span><br><span class="line">                    success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">                        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = wxApi.length; i &lt; len; i++) &#123;</span><br><span class="line">                            <span class="keyword">switch</span> (api检查通过 &amp;&amp; wxApi[i]) &#123;</span><br><span class="line">                                <span class="keyword">case</span> wxApiData.forFriend:</span><br><span class="line">                                    <span class="comment">// 调用分享给朋友wx api</span></span><br><span class="line">                                    <span class="keyword">break</span>;</span><br><span class="line">                                <span class="keyword">case</span> wxApiData.forGroup:</span><br><span class="line">                                    <span class="comment">// 调用分享给朋友圈wx api</span></span><br><span class="line">                                    <span class="keyword">break</span>;</span><br><span class="line">                                <span class="keyword">default</span>:</span><br><span class="line">                                    <span class="built_in">console</span>.log(<span class="string">'部分功能不支持，请使用最新版微信'</span>);</span><br><span class="line">                                    <span class="keyword">break</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">            wx.error(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">"配置初始化错误"</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="微信分享本地测试方法"><a href="#微信分享本地测试方法" class="headerlink" title="微信分享本地测试方法"></a>微信分享本地测试方法</h3><ol>
<li>获取微信平台安全域名，比如test.com</li>
<li>修改本地host配置<ol>
<li>xxx.xxx.xx.xx test.com（xxx.xxx.xx.xx你的ip地址，mac下使用ifconfig | grep “inet “ | grep -v 127.0.0.1获取）</li>
</ol>
</li>
<li>nginx代理test.com:80 =&gt; localhost:port(你的本地服务，locate nginx.conf查看nginx配置文件在哪)<br> <img src="https://raw.githubusercontent.com/FoxDaxian/FoxDaxian.github.io/master/assets/picgo/20190702161827.png" alt></li>
<li>手机连接和电脑相同的wifi，连接charles</li>
<li>手机扫码打开h5，即可进行微信分享</li>
</ol>
<h3 id="一些问题"><a href="#一些问题" class="headerlink" title="一些问题"></a>一些问题</h3><ol>
<li>签名错误，按照以下顺序查找问题<ol>
<li>检查签名是否正确<a href="http://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=jsapisign" target="_blank" rel="noopener">校验地址</a></li>
<li>检查wx.config的字段大小写拼写是否正确</li>
<li>确定url的完整性，仅仅不包括#以及#后面的</li>
<li>确认 config 中的 appid 与用来获取 jsapi_ticket 的 appid 一致。</li>
<li>检查获取wx config字段的接口的url是否和当前待分享页url一致，并且属于安全域名</li>
</ol>
</li>
<li>配置好本地测试后，如果遇到其他接口504 gate way time-out，请检查配置的host时候与api地址冲突</li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/memory/2021/05/09/bugOfArray/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FoxDaxian">
      <meta itemprop="description" content="遇到好玩的，稀奇的，新鲜的，记录下来，分享出去。">
      <meta itemprop="image" content="/memory/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fox的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/memory/2021/05/09/bugOfArray/" class="post-title-link" itemprop="url">js数组中的漏洞</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2021-05-09 23:37:00" itemprop="dateCreated datePublished" datetime="2021-05-09T23:37:00+00:00">2021-05-09</time>
            </span>
          

          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/memory/categories/原理/" itemprop="url" rel="index"><span itemprop="name">原理</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这边文章介绍了js中各个数组方法是如何处理数组中有空元素的</p>
<ol>
<li>运行实例<br>所有的方法都基于下面这个数组：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="string">'a'</span>, , <span class="string">'b'</span>]</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>如你所见，我们创建一个数组，第一位是a，第二位是空，第三位是b</p>
<ol start="2">
<li><p>预热</p>
<ol>
<li><p>数组最后一个位置是空<br>在本文中，需要注意的是，js会忽略数组中最后的逗号，这意味着，如果你想在数组的最后添加空元素，你需要增加两个逗号：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; [<span class="string">'a'</span>, <span class="string">'b'</span>, ]</span><br><span class="line">[ <span class="string">'a'</span>, <span class="string">'b'</span> ]</span><br><span class="line">&gt; [<span class="string">'a'</span>, <span class="string">'b'</span>, , ]</span><br><span class="line">[ <span class="string">'a'</span>, <span class="string">'b'</span>, empty ]</span><br></pre></td></tr></table></figure>
</li>
<li><p>数组复制<br>我们使用sclice创建一个arr的浅克隆副本</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr2 = arr.slice();</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>右边部分等价于：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arr.slice(<span class="number">0</span>, arr.length);</span><br></pre></td></tr></table></figure>
</li>
<li><p>数组方法对待空元素的表现</p>
</li>
</ol>
<ul>
<li><p>foreach会跳过空元素</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; arr.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">x, i</span>) </span>&#123;</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;i&#125;</span>.<span class="subst">$&#123;x&#125;</span>`</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 输出</span></span><br><span class="line">    <span class="number">0.</span>a</span><br><span class="line">    <span class="number">2.</span>b</span><br></pre></td></tr></table></figure>
</li>
<li><p>every和some也会跳过</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; arr.every(<span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123; <span class="keyword">return</span> x.length === <span class="number">1</span> &#125;)</span><br><span class="line">    <span class="comment">// 输出</span></span><br><span class="line">    <span class="literal">true</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>map会跳过空元素的那次，但是会保留空元素的位置</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; arr.map(<span class="function"><span class="keyword">function</span> (<span class="params">x,i</span>) </span>&#123; <span class="keyword">return</span> i+<span class="string">'.'</span>+x &#125;)</span><br><span class="line">    <span class="comment">// 输出</span></span><br><span class="line">    [ <span class="string">'0.a'</span>, , <span class="string">'2.b'</span> ]</span><br></pre></td></tr></table></figure>
</li>
<li><p>filter会移除空元素</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; arr.filter(<span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123; <span class="keyword">return</span> <span class="literal">true</span> &#125;)</span><br><span class="line">    <span class="comment">// 输出</span></span><br><span class="line">    [ <span class="string">'a'</span>, <span class="string">'b'</span> ]</span><br></pre></td></tr></table></figure>
</li>
<li><p>join会转换undefined和空元素为空的字符串：’’</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; arr.join(<span class="string">'-'</span>)</span><br><span class="line">   <span class="comment">// 输出</span></span><br><span class="line">   <span class="string">'a--b'</span></span><br><span class="line">   &gt; [ <span class="string">'a'</span>, <span class="literal">undefined</span>, <span class="string">'b'</span> ].join(<span class="string">'-'</span>)</span><br><span class="line">   <span class="comment">// 输出</span></span><br><span class="line">   <span class="string">'a--b'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>其他方法都会保留空元素</p>
</li>
</ul>
<ol start="4">
<li><p>循环<br>for循环不访问数组，for-ion循环正确的列出了所有的键值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">var</span> arr2 = arr.slice()</span><br><span class="line">&gt; arr2.foo = <span class="number">123</span>;</span><br><span class="line">&gt; <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> arr2) &#123; <span class="built_in">console</span>.log(key) &#125;</span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line">foo</span><br><span class="line">解释：因为数组是对象，所以会打印对象中的key，其他则会忽略非数字key</span><br></pre></td></tr></table></figure>
</li>
<li><p>Function.prototype.apply()<br>apply方法将空元素看做undefined，这样提供了一个非常简单的方法去创建一个由undefined组成的特定长度的数组。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 元素为undefined</span></span><br><span class="line">&gt; <span class="built_in">Array</span>.apply(<span class="literal">null</span>, <span class="built_in">Array</span>(<span class="number">3</span>))</span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">[ <span class="literal">undefined</span>, <span class="literal">undefined</span>, <span class="literal">undefined</span> ]</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>如果不指定this，那么：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 空元素</span></span><br><span class="line">&gt; <span class="built_in">Array</span>(<span class="number">3</span>)</span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">[ , , , , ]</span><br></pre></td></tr></table></figure>

<p>apply很容易的插入空元素到数组中，但是，你不能使用它执行任意数组，因为这些数组可能包含也可能不包含空元素，例如，任意数组[2]不包含空元素，apply应该返回’unchangede’，但是还是创建了一个长度为2的数组，因为Array()解释数组为数组长度，而不是数组元素</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">Array</span>.apply(<span class="literal">null</span>, [<span class="number">2</span>])</span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">[ , ,]</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>总结和建议<br>我们看到js有很多处理漏洞的方式，不过庆幸的是，我们一般不需要关心他是如何处理的，因为这种漏洞应该被避免，漏洞会造成性能问题，几乎百害无一用</li>
<li>扩展阅读<br><a href="http://2ality.com/2012/06/dense-arrays.html" target="_blank" rel="noopener">稀疏数组和密集数组</a><br><a href="http://2ality.com/2011/04/iterating-over-arrays-and-objects-in.html" target="_blank" rel="noopener">js迭代数组和对象</a><br><a href="http://2ality.com/2013/07/array-iteration-holes.html" target="_blank" rel="noopener">原文链接</a></li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/memory/2021/05/09/console/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FoxDaxian">
      <meta itemprop="description" content="遇到好玩的，稀奇的，新鲜的，记录下来，分享出去。">
      <meta itemprop="image" content="/memory/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fox的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/memory/2021/05/09/console/" class="post-title-link" itemprop="url">console介绍</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2021-05-09 23:37:00" itemprop="dateCreated datePublished" datetime="2021-05-09T23:37:00+00:00">2021-05-09</time>
            </span>
          

          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/memory/categories/介绍/" itemprop="url" rel="index"><span itemprop="name">介绍</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>工作中console可能是用来debug的最频繁的原生方法了，它不仅仅非常实用，而且还有一些有趣的东西。</p>
<ul>
<li><p>console.log</p>
<ol>
<li><p>常见占位符</p>
<p> <strong>%o</strong>:接受Object<br> <strong>%s</strong>:接受String<br> <strong>%d</strong>:接受Number</p>
<p> <img src="https://foxdaxian.github.io/assets/01_console/base_log.png" alt="图片"></p>
</li>
<li><p>css占位符<br> <strong>%c</strong>:接受CSS</p>
<p> <img src="https://foxdaxian.github.io/assets/01_console/color_log.png" alt="图片"></p>
</li>
</ol>
</li>
</ul>
<hr>
<ul>
<li>console.dir<ol>
<li>打印对象的时候与console.log无明显区别，但是当打印元素的时候有明显区别，如图：<br><img src="https://foxdaxian.github.io/assets/01_console/dir.gif" alt="图片"><br>log会展示当前节点以及子孙节点，dir会展示节点的所有属性</li>
</ol>
</li>
</ul>
<hr>
<ul>
<li>console.warn<ol>
<li>在输出上与console.log不同，它的输出为黄色警告样式</li>
</ol>
</li>
</ul>
<hr>
<ul>
<li>console.table<ol>
<li>输出漂亮的格式化后的数组，并且提供排序功能，有可选的第二个数组参数，过滤想要展示的key。不过该方法仅仅能展示最多1000行，所以不适合处理数据量大的数组。如图：<br><img src="https://foxdaxian.github.io/assets/01_console/table.gif" alt="图片"></li>
</ol>
</li>
</ul>
<hr>
<ul>
<li>console.assert<ol>
<li>有至少两个参数，第一个参数为条件，当条件为真的时候，无任何输出，当条件为false的时候，像console.log一样输出之后的所有参数</li>
</ol>
</li>
</ul>
<hr>
<ul>
<li>console.count<ol>
<li>记录调用的次数，接受一个参数作为输出前缀，可以通过<code>console.countReset ()</code>重置</li>
</ol>
</li>
</ul>
<hr>
<ul>
<li>console.trace<ol>
<li>输出堆栈跟踪记录，如图<br><img src="https://foxdaxian.github.io/assets/01_console/trace.png" alt="图片"></li>
</ol>
</li>
</ul>
<hr>
<ul>
<li>console.time &amp; console.timeEnd<ol>
<li>记录js操作花费了多长时间，接受一个参数，该参数在两个方法里必须都一致才能输出计算时间，单位为毫秒，如图<br><img src="https://foxdaxian.github.io/assets/01_console/time.png" alt="图片"></li>
</ol>
</li>
</ul>
<hr>
<ul>
<li>console.group &amp; console.groupEnd<ol>
<li>在控制台创建新的缩进列，以group开始，以groupEnd接受，group接受一个参数，来表示缩进前缀，如图<br><img src="https://foxdaxian.github.io/assets/01_console/group.png" alt="图片"></li>
</ol>
</li>
</ul>
<hr>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p><strong>console对象上还有一些其他方法，这里就不过多介绍了，以上方法，用的做多的仅仅只有console.log，其他的偶会会用到，不过知道了真的就是知道了。</strong></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/memory/2021/05/09/webview/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FoxDaxian">
      <meta itemprop="description" content="遇到好玩的，稀奇的，新鲜的，记录下来，分享出去。">
      <meta itemprop="image" content="/memory/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fox的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/memory/2021/05/09/webview/" class="post-title-link" itemprop="url">浏览器内核</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2021-05-09 23:37:00" itemprop="dateCreated datePublished" datetime="2021-05-09T23:37:00+00:00">2021-05-09</time>
            </span>
          

          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/memory/categories/原理/" itemprop="url" rel="index"><span itemprop="name">原理</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>浏览器是用户的窗口，而这个窗口则是前端工程师们的舞台。<br>据统计，目前常见的浏览器有：</p>
<ul>
<li>谷歌</li>
<li>火狐</li>
<li>ie、edge</li>
<li>opera</li>
<li>safari</li>
<li>uc</li>
<li>qq</li>
<li>搜狗</li>
<li>360</li>
<li>百度</li>
</ul>
<p><a href="https://zh.wikipedia.org/wiki/%E7%BD%91%E9%A1%B5%E6%B5%8F%E8%A7%88%E5%99%A8#/media/File:Usage_share_of_web_browsers_(Source_StatCounter).svg" target="_blank" rel="noopener">浏览器占比</a></p>
<p>对于前端来说，浏览器是一台转换代码的机器，将代码转换成用户可以看到的界面，但是，如何解释和执行代码却因为浏览器的种类繁多而千差万别。而决定如何解释和执行代码的就是浏览器内核(排版引擎 | 浏览器引擎  |  页面渲染引擎  | 渲染引擎)。</p>
<p><img src="https://raw.githubusercontent.com/FoxDaxian/FoxDaxian.github.io/master/assets/07_browser_webview/browser-construct.png" alt="浏览器结构"></p>
<ol>
<li>用户界面<br> 你能看到的，包括工具栏、导航栏、书签菜单等等</li>
<li>浏览器引擎<br> 是一个可嵌入的组件，为渲染引擎提供高级接口。<br> 可以加载一个指定的URI，支持和历史记录相关的操作<br> 查询和修改渲染引擎</li>
<li>渲染引擎<br> 显示请求的内容，比如解析html、css，并将解析后的render tree渲染到浏览器中</li>
<li>网络<br> 用于网络调用，具有独立性，可在不同平台使用</li>
<li>js解释器<br> 用来解释执行js代码，由于安全问题，浏览器引擎和渲染引擎可能会禁止掉某些js功能。</li>
<li>xml解析器<br> 将xml文档解析成文档对象模型树，xml解析器是浏览器结构中复用最多的子系统之一，几乎所有的浏览器都复用现有的xml解析器，而不是从头开始</li>
<li>显示后端<br> 显示后端提供绘图和窗口原语，包括用户界面控件集合、字体集合</li>
<li>数据持久层<br> 数据持久层将会话相关的各种数据存储在硬盘上。比如书签，工具栏设置，比如cookies，安全证书，localstore</li>
</ol>
<p>一般来说，浏览器只有一个内核，但是为了ie，发明了双核浏览器，大部分都是<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line">webkit是苹果研发的，chrome起初使用webkit，后来另起分支blink，并且越来越好</span><br><span class="line">[视频介绍](https://www.youtube.com/watch?v=DQPqZPTIESc&amp;t=8s)</span><br><span class="line"></span><br><span class="line">接着说说移动端的浏览器内核。</span><br><span class="line"></span><br><span class="line">首先移动端不像pc，网站都是前端开发的。移动端目前来说常用的有下面几种：</span><br><span class="line"></span><br><span class="line">|  |  native  |  rn、wx、flutter  | hybrid | webapp |</span><br><span class="line">| -- | -- | -- | -- | -- |</span><br><span class="line">| 跨平台 | 复杂 | 容易 | 容易 | 容易 |</span><br><span class="line">| 版本更新 | 慢 | 快 | 快 | 快 |</span><br><span class="line">| 性能和体验 | 最高 | 高 | 一般 | 一般 |</span><br><span class="line">| 学习和开发成本 | 很大 | 大 | 一般 | 一般 |</span><br><span class="line"></span><br><span class="line">这里拿和浏览器内核有关的```hybrid```和```webapp```来说，其余感兴趣的在做深入了解。</span><br><span class="line"></span><br><span class="line">介绍移动端内核之前，简单介绍一下hybrid和webapp，hybrid是native的webview容器中的webapp，webapp就是普通的页面。正因为有这个webview的关系，导致hybrid自诞生以来就比webapp多了一个初始化webview容器的这个损耗，所以才会有后面的rn，flutter等等。简单的解释下这个过程：</span><br><span class="line"></span><br><span class="line">在浏览器中，我们输入地址时，浏览器就可以加载页面。</span><br><span class="line"></span><br><span class="line">![浏览器结构](https://raw.githubusercontent.com/FoxDaxian/FoxDaxian.github.io/master/assets/07_browser_webview/borwser.png)</span><br><span class="line"></span><br><span class="line">在客户端中，首先需要花费时间初始化webview，才能加载页面。所以如果webview没有加载完毕，用户可能就会看到白屏影响体验。</span><br><span class="line"></span><br><span class="line">![浏览器结构](https://raw.githubusercontent.com/FoxDaxian/FoxDaxian.github.io/master/assets/07_browser_webview/webview.png)</span><br><span class="line"></span><br><span class="line">当然，也不是没有优化方案。比如：</span><br><span class="line">- 使用单例模式去初始化webview，这样只有在第一次的时候回慢一些，之后就没问题了，缺点就是内存消耗和怎么处理同时存在多个webview</span><br><span class="line">- 将网络请求相关交给native去做，也就是初始化webview和网络请求并行的方案，即客户端代理数据请求</span><br><span class="line">- dns采用和客户端api相同的域名，类似dns预解析</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">我们都知道手机有两大主类：Android和IOS。不过总的来说大部分都在使用webkit或者类webkit内核。</span><br><span class="line"></span><br><span class="line">webapp：</span><br><span class="line">- ios safari 使用webkit内核</span><br><span class="line">- android4.4之前使用webkit，4.4之后切换到了chromium（基于一个webkit的分支blink，是chrome的先行版）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">webview(webkit内核+js引擎)：</span><br><span class="line">- ios8之前使用uiwebview，之后使用wkwebview</span><br><span class="line">- 安卓常用的有：</span><br><span class="line"></span><br><span class="line">安卓4.4之前的webkit内核和4.4之后的blink内核：</span><br><span class="line"></span><br><span class="line">|  |  webkit  |  chromium  |  备注  |</span><br><span class="line">| -- | -- | -- | -- |</span><br><span class="line">| html5test  |  278  |  434  | http://html5test.com/  |</span><br><span class="line">| 远程调试  |  不支持  |  支持  |  安卓4.4以上支持 |</span><br><span class="line">| 内存占用  |  小  |  大  |  相差20-30M左右  |</span><br><span class="line">| WebAudio  |  不支持  |  支持  |  Android 5.0及以上支持  |</span><br><span class="line">| WebGL  |  不支持  |  支持  |  Android 5.0及以上支持  |</span><br><span class="line">| WebRTC  |  不支持  |  支持  |  Android 5.0及以上支持  |</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">由于低版本安卓的有很多兼容的问题，所以一般会采用三方webview，常见的：</span><br><span class="line"></span><br><span class="line">| 类别 | 介绍 | 性能 | 特点 | html5test |</span><br><span class="line">| -- | -- | -- | -- | -- |</span><br><span class="line">| 系统自带webview | 安卓默认 | 一般 | 没有额外jar负担，原生api，不过兼容性差 | 一般 |</span><br><span class="line">| X5 webview | 腾讯出品 | 一般 | 兼容性好，可信度高，不过工作量会增大，并且不支持Cordova | 良好 |</span><br><span class="line">| crosswalk | 国外为安卓提供的一个融合webkit的方案 | 优 | 无兼容性，性能问题，支持Cordova，不过体积大 | 较佳 |</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">两个优化方案。</span><br><span class="line">### 首先是webp</span><br><span class="line"></span><br><span class="line">3w方法：</span><br><span class="line">1. 什么是webp</span><br><span class="line">2. webp是怎么做的</span><br><span class="line">3. 如何使用webp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### 什么是webp</span><br><span class="line">webp是一种可以有损或无损的压缩图片的方法，能够适用于有很多图片资源的网站上，它还供你选择压缩程度，让你自由控制图片大小和图片质量，在不影响质量的前提下，大约可以节省30%的体积，详细见：[官网比较](https://developers.google.com/speed/webp/docs/c_study)</span><br><span class="line">#### webp是怎么做的</span><br><span class="line">我们知道，在大部分网站中，图片占用了60%左右的页面资源，这非常影响整个渲染时间，而且，在移动端页面大小更是重要，这关系到流量和电池寿命。那webp是怎么做的呢？</span><br><span class="line"></span><br><span class="line">1. 有损压缩</span><br><span class="line">有损webp基于VP8视频编码方法来压缩图像数据，基础步骤类似于JPEG压缩,流程如下图所示，红色部门代表与JPEG不同的部分。</span><br><span class="line">![alt](https://raw.githubusercontent.com/FoxDaxian/FoxDaxian.github.io/master/assets/07_browser_webview/webpProcess.jpg)</span><br><span class="line">    1. 格式转换</span><br><span class="line">    若压缩前图像数据为RGB格式，则需要先将格式转换成YUV格式，Y表示亮度，UV表示色度，之所以这么做是因为人类的眼睛对色度敏感度比亮度低，所以可通过减少色度来减少图片占用空间。比如每四个相邻像素点采用一对UV值</span><br><span class="line">    2. 分割宏块</span><br><span class="line">    将数据分割成4 * 4或8 * 8 或 16 * 16的宏块</span><br><span class="line">    3. 预测编码</span><br><span class="line">    预测编码的原理是基于前面编码好的宏块，预测多余的动作颜色等信息，属于帧内预测（帧内预测是一个物理学术语，指的是H.264采用的一种新技术）</span><br><span class="line">        - H_PRED（horizontal prediction）使用宏块左边的一列（简称L）来填充剩余列</span><br><span class="line">        - V_PRED（vertical prediction） 使用宏块上面的一行（简称A）来填充剩余行</span><br><span class="line">        - DC_PRED（DC prediction） 使用L和A的所有像素的平均值填充宏块</span><br><span class="line">        - TM_PRED（TrueMotion prediction） 使用渐进的方式</span><br><span class="line">        下面展示了不同帧内预测的模式</span><br><span class="line">        ![alt](https://raw.githubusercontent.com/FoxDaxian/FoxDaxian.github.io/master/assets/07_browser_webview/compression-intra_modes.png)</span><br><span class="line">    4. 接下来通过FDCT（正向离散余弦变换）处理残差。让变换后的数据低频部分分布在数据块左上方，高频集中在右下方以实现更高效的压缩</span><br><span class="line">    5. 最后将结果量化并进行熵编码，webp使用布尔算数编码作为熵编码方式，直接把输入的消息编码为一个满足(0.0 &lt;= n &lt;= 1.0)的小数n</span><br><span class="line"></span><br><span class="line">2. 无损压缩</span><br><span class="line">无损webp采用了预测变换、颜色变换、减去绿色变换、彩色缓存编码、LZ77反响参考等不同技术来处理图像，之后对变换图像数据和参数进行熵编码，有兴趣的自行了解。</span><br><span class="line"></span><br><span class="line">#### 如何使用webp</span><br><span class="line">首先是支持度：</span><br><span class="line">pc上谷歌、火狐、edge、opera支持度很好，换句话说使用blink内核的都没啥问题。</span><br><span class="line">android4以上 ios支持过一段时间，后来移除了，web端支持尚好，不过ie和safari完全不支持</span><br><span class="line">详见[wiki](https://en.wikipedia.org/wiki/WebP#Support)</span><br><span class="line">其实，目前有很多垫片已经几乎可以做到常用环境全支持webp了，比如</span><br><span class="line">- [安卓4.0以下支持](https://github.com/alexey-pelykh/webp-android-backport)</span><br><span class="line">- [ios支持](https://github.com/carsonmcdonald/WebP-iOS-example)</span><br><span class="line">不过这些是native那边做的，那我们前端怎么做呢？</span><br><span class="line">- 服务端</span><br><span class="line">    1. 通过accetp头信息进行协商</span><br><span class="line">    发送accept字段非常常见，这个字段说明浏览器可以接受的内容类型，如果浏览器发送一个*image/webp*，那么服务端就知道浏览器支持webp格式，然后直接使用ok</span><br><span class="line"></span><br><span class="line">- 客户端 </span><br><span class="line">    1. [Modernizr](https://github.com/Modernizr/Modernizr)</span><br><span class="line">    Modernizr是一个js库，可以非常方便的查看你的浏览器H5/Css3的支持度，你可以查看下面这些字段：Modernizr.webp, Modernizr.webp.lossless, Modernizr.webp.alpha and Modernizr.webp.animation</span><br><span class="line">    2. 使用H5的**picture**元素</span><br><span class="line">    picture允许你放置多个source和一个回退的img，就算webp不支持，也会显示回退方案</span><br><span class="line">    3. 使用js</span><br><span class="line">    这是尝试解码一个非常小的不同版本webp图片</span><br><span class="line">```javascript</span><br><span class="line">//  check_webp_feature:</span><br><span class="line">//  &apos;feature&apos; can be one of &apos;lossy&apos;, &apos;lossless&apos;, &apos;alpha&apos; or &apos;animation&apos;.</span><br><span class="line">//  &apos;callback(feature, result)&apos; will be passed back the detection result (in an asynchronous way!)</span><br><span class="line">function check_webp_feature(feature, callback) &#123;</span><br><span class="line">    var kTestImages = &#123;</span><br><span class="line">        lossy: &quot;UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA&quot;,</span><br><span class="line">        lossless: &quot;UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA==&quot;,</span><br><span class="line">        alpha: &quot;UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAARBxAR/Q9ERP8DAABWUDggGAAAABQBAJ0BKgEAAQAAAP4AAA3AAP7mtQAAAA==&quot;,</span><br><span class="line">        animation: &quot;UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA&quot;</span><br><span class="line">    &#125;;</span><br><span class="line">    var img = new Image();</span><br><span class="line">    img.onload = function () &#123;</span><br><span class="line">        var result = (img.width &gt; 0) &amp;&amp; (img.height &gt; 0);</span><br><span class="line">        callback(feature, result);</span><br><span class="line">    &#125;;</span><br><span class="line">    img.onerror = function () &#123;</span><br><span class="line">        callback(feature, false);</span><br><span class="line">    &#125;;</span><br><span class="line">    img.src = &quot;data:image/webp;base64,&quot; + kTestImages[feature];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="再说说variable-fonts"><a href="#再说说variable-fonts" class="headerlink" title="再说说variable fonts"></a>再说说variable fonts</h3><p>之前就有了解，直接抛链接了: <a href="https://github.com/FoxDaxian/memory/issues/4" target="_blank" rel="noopener">variable fonts</a><br><a href="https://v-fonts.com/support/" target="_blank" rel="noopener">支持程度</a></p>
<h5 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h5><p><a href="http://chuquan.me/2018/01/21/browser-architecture-overview/" target="_blank" rel="noopener">现代浏览器工作原理</a><br><a href="http://www.eyee21.com/category/%E6%B5%8F%E8%A7%88%E5%99%A8" target="_blank" rel="noopener">浏览器内核</a><br><a href="https://www.cnblogs.com/pqjwyn/p/7120342.html" target="_blank" rel="noopener">前端解读webview</a><br><a href="https://tech.meituan.com/2017/06/09/webviewperf.html" target="_blank" rel="noopener">美团webview性能、体验分析和优化</a><br><a href="http://web.jobbole.com/84826/" target="_blank" rel="noopener">主流浏览器内核介绍</a><br><a href="https://lingenliu.com/2016/09/03/something-about-android-webview/" target="_blank" rel="noopener">安卓webview选择对比</a><br><a href="https://developers.google.com/speed/webp/" target="_blank" rel="noopener">webp官网</a><br><a href="https://tech.upyun.com/article/253/%E9%83%BD%E8%AF%B4%20WebP%20%E5%8E%89%E5%AE%B3%EF%BC%8C%E7%A9%B6%E7%AB%9F%E5%8E%89%E5%AE%B3%E5%9C%A8%E5%93%AA%E9%87%8C%EF%BC%9F%20.html" target="_blank" rel="noopener">webp原理</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/memory/2021/05/09/cssForm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FoxDaxian">
      <meta itemprop="description" content="遇到好玩的，稀奇的，新鲜的，记录下来，分享出去。">
      <meta itemprop="image" content="/memory/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fox的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/memory/2021/05/09/cssForm/" class="post-title-link" itemprop="url">css实现表单验证</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2021-05-09 23:37:00" itemprop="dateCreated datePublished" datetime="2021-05-09T23:37:00+00:00">2021-05-09</time>
            </span>
          

          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/memory/categories/原理/" itemprop="url" rel="index"><span itemprop="name">原理</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="有没有办法只通过css来确定input标签是否有输入？"><a href="#有没有办法只通过css来确定input标签是否有输入？" class="headerlink" title="有没有办法只通过css来确定input标签是否有输入？"></a>有没有办法只通过css来确定input标签是否有输入？</h4><p>我有这个想法是因为我想完成一个自动补全的input部件，最基本的功能是：</p>
<ul>
<li>如果input没有内容，这隐藏下拉框</li>
<li>反之，显示下拉框</li>
</ul>
<p>我找到了一个也许不是很完美的实现方案，描述中可能会有一些细微的区别，不过我还是很希望能做这个简单的分享</p>
<hr>
<p>首先，我们构造一个简单的form表单，仅仅只有一个input</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="selector-tag">form</span>&gt;</span><br><span class="line">	&lt;label for="input"&gt;输入框&lt;/label&gt;</span><br><span class="line">    &lt;input type="text" id="input"/&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<p>当输入一些值，我设置input的边框颜色为绿的，下面是一个例子:<br><img src="https://foxdaxian.github.io/assets/04_input_only_css/check.gif" alt="gif"></p>
<h4 id="判断input是否为空"><a href="#判断input是否为空" class="headerlink" title="判断input是否为空"></a>判断input是否为空</h4><p>我通过html表单验证去判断是否为空，所以，这里我使用了<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">```css</span><br><span class="line">&lt;form&gt;</span><br><span class="line">	&lt;label&gt; Input &lt;/label&gt;</span><br><span class="line">	&lt;input type=&quot;text&quot; name=&quot;input&quot; id=&quot;input&quot; required /&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">// valid：当input输入值也合法值时采用的样式</span><br><span class="line">#input:valid&#123;</span><br><span class="line">	border-color: green;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这时，当有输入的时候，input表现的很好，边框颜色也有了相应的变化：</p>
<p><img src="https://foxdaxian.github.io/assets/04_input_only_css/check2.gif" alt="gif"></p>
<p>但是，这里有个问题，如果用户输入的是空格，那么边框颜色也会发生改变。</p>
<p><img src="https://foxdaxian.github.io/assets/04_input_only_css/check-whitespace.gif" alt="gif"></p>
<p>原理上看，这种表现是正常的，因为输入框确实有了内容。<br>但是，实际上，我不想让空格来触发自动补全弹窗<br>所以这还不能满足我们的需求，我要做更细致的检查</p>
<h4 id="进一步完善"><a href="#进一步完善" class="headerlink" title="进一步完善"></a>进一步完善</h4><p>html提供我们利用正则去验证输入框内容的属性:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">因为想把空格视为非法输入，我使用```\S+```，这个很简单，匹配一个或者多个任何非空白字符</span><br><span class="line">```css</span><br><span class="line">&lt;form&gt;</span><br><span class="line">	&lt;label&gt; Input &lt;/label&gt;</span><br><span class="line">	&lt;input type=&quot;text&quot; name=&quot;input&quot; id=&quot;input&quot; required pattern=&quot;\S+&quot;/&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure></p>
<p>使用这种方式，的确奏效了，如果用户输入空格，输入框没有任何变化</p>
<p><img src="https://foxdaxian.github.io/assets/04_input_only_css/check-pattern-pre1.gif" alt="gif"></p>
<p>但了个是，但是这个正则还是有问题，因为只允许输入非空白字符，所以你在任何位置输入空白都会导致输入框校验失败</p>
<p><img src="https://foxdaxian.github.io/assets/04_input_only_css/check-pattern1.gif" alt="gif"></p>
<p>这里可以使用其他的正则来匹配，比如<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">```css</span><br><span class="line">&lt;form&gt;</span><br><span class="line">	&lt;label&gt; Input &lt;/label&gt;</span><br><span class="line">	&lt;input type=&quot;text&quot; name=&quot;input&quot; id=&quot;input&quot; required pattern=&quot;\S+.*&quot;/&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure></p>
<p>现在输入框可以和空格混合输入了！<br>但是如果当前校验失败，输入框没有任何提示，这很不友好！<br>但我写这篇文章的时候，有一个问题我不断思考，能不能只用css给非法验证也加一种样式？</p>
<h4 id="输入无效"><a href="#输入无效" class="headerlink" title="输入无效"></a>输入无效</h4><p>这里不能使用<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">查看了相关资源，我们可以使用```:placeholder-shown```来达到我们的目的</span><br><span class="line"></span><br><span class="line">大概思路是：</span><br><span class="line">- 增加placeholder</span><br><span class="line">- 如果输入框如果用户输入了内容，但还不合法做一个处理</span><br><span class="line">- 最后利用css的覆盖特性，添加一个当验证成功的样式处理</span><br><span class="line"></span><br><span class="line">最终的css大概是这样</span><br><span class="line">```css</span><br><span class="line">/* 当填充的时候展示红色，所以这里默认是校验失败 */</span><br><span class="line">input:not(:placeholder-shown) &#123;</span><br><span class="line">	border-color: hsl(0, 76%, 50%);</span><br><span class="line">&#125;</span><br><span class="line">/* 当验证成功的时候，采用这个样式 */</span><br><span class="line">input:valid &#123;</span><br><span class="line">	border-color: hsl(120, 76%, 50%);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这里有一个小小的<a href="https://codepen.io/zellwk/pen/dgEKxX/" target="_blank" rel="noopener">demo</a></p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>上面的内容就是如何只用css来提供一个基础表单验证功能，说是只用css，其实也利用的<code>pattern</code>能接受正则表达式，哈哈，所以最根本的是如何写出最优的正则表达式。</p>
<p><a href="https://dev.to/zellwk/checking-if-an-input-is-empty-with-css-1fn3" target="_blank" rel="noopener">原文链接</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/memory/2021/05/09/cssRamdon/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FoxDaxian">
      <meta itemprop="description" content="遇到好玩的，稀奇的，新鲜的，记录下来，分享出去。">
      <meta itemprop="image" content="/memory/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fox的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/memory/2021/05/09/cssRamdon/" class="post-title-link" itemprop="url">css实现伪随机数</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2021-05-09 23:37:00" itemprop="dateCreated datePublished" datetime="2021-05-09T23:37:00+00:00">2021-05-09</time>
            </span>
          

          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/memory/categories/黑魔法/" itemprop="url" rel="index"><span itemprop="name">黑魔法</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="前言时间急，任务重，直接上原理和代码。"><a href="#前言时间急，任务重，直接上原理和代码。" class="headerlink" title="前言时间急，任务重，直接上原理和代码。"></a>前言时间急，任务重，直接上原理和代码。</h3><h3 id="原理和问题"><a href="#原理和问题" class="headerlink" title="原理和问题"></a>原理和问题</h3><p>前提是需要label和input，这样才能让css知道当前选中了哪个，也就是checked属性。<br>然后利用z-index的keyframes实现一个有规律但是delay各不相同的animation。</p>
<p><img src="https://res.cloudinary.com/css-tricks/image/upload/c_scale,w_400,f_auto,q_auto/v1571697450/random-01_tavjbx.gif" alt="alt"></p>
<p>有一个小问题是，浏览器触发click和press事件的前提是，mousedown 和 mouseup都作用于同一个element对象才行，你可以自己实践一下，就是在一个可点击的元素上，按下鼠标左键，然后鼠标移出这个可点击的元素，松开鼠标左键，看看会不会触发这个元素本身的行为。<br>这个问题会导致一种看起来点击失效的问题，不过我们可以通过点击重置element的position行为，然后提供一个z-index最高的可视区mask，这样就保证了我们mouseup和mousedown始终在同一个element对象上了。</p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">* &#123;</span><br><span class="line">    <span class="attribute">user-select</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">keyframes</span> zindex &#123;</span><br><span class="line">    0% &#123;</span><br><span class="line">        <span class="attribute">z-index</span>: <span class="number">9</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    100% &#123;</span><br><span class="line">        <span class="attribute">z-index</span>: <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.randomBox</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.randomBox</span>&gt;<span class="selector-tag">label</span> &#123;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">8px</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid red;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.randomBox</span> <span class="selector-class">.one</span> &#123;</span><br><span class="line">    <span class="attribute">animation</span>: zindex <span class="number">0.3s</span> <span class="number">0s</span> infinite;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.randomBox</span> <span class="selector-class">.two</span> &#123;</span><br><span class="line">    <span class="attribute">animation</span>: zindex <span class="number">0.3s</span> -<span class="number">0.1s</span> infinite;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.randomBox</span> <span class="selector-class">.three</span> &#123;</span><br><span class="line">    <span class="attribute">animation</span>: zindex <span class="number">0.3s</span> -<span class="number">0.2s</span> infinite;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">input</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">visibility</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.value</span> &#123;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">50px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">input</span><span class="selector-id">#one</span><span class="selector-pseudo">:checked</span>~<span class="selector-class">.value</span> <span class="selector-class">.one</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">input</span><span class="selector-id">#two</span><span class="selector-pseudo">:checked</span>~<span class="selector-class">.value</span> <span class="selector-class">.two</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">input</span><span class="selector-id">#three</span><span class="selector-pseudo">:checked</span>~<span class="selector-class">.value</span> <span class="selector-class">.three</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">label</span><span class="selector-pseudo">:active</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: static;</span><br><span class="line">    <span class="attribute">margin-left</span>: -<span class="number">1000px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">label</span><span class="selector-pseudo">:active</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">""</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">10</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>css实现随机数<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">id</span>=<span class="string">"one"</span> <span class="attr">name</span>=<span class="string">"random"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">id</span>=<span class="string">"two"</span> <span class="attr">name</span>=<span class="string">"random"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">id</span>=<span class="string">"three"</span> <span class="attr">name</span>=<span class="string">"random"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"randomBox"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"one"</span> <span class="attr">class</span>=<span class="string">"one"</span>&gt;</span>随机一个数<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"two"</span> <span class="attr">class</span>=<span class="string">"two"</span>&gt;</span>随机一个数<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"three"</span> <span class="attr">class</span>=<span class="string">"three"</span>&gt;</span>随机一个数<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"value"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"one"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"two"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"three"</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 下面的js用来验证点击是否按照预期触发 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> labels = <span class="built_in">document</span>.querySelectorAll(<span class="string">'label'</span>);</span></span><br><span class="line"><span class="javascript">    labels.forEach(<span class="function">(<span class="params">label, index</span>) =&gt;</span> label.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;index&#125;</span>被点击了`</span>);  </span></span><br><span class="line">    &#125;))</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>上面就实现了一个最简单的css随机数，当然这个效果可能不是很明显，如果更复杂就会更逼真，比如这个<a href="https://codepen.io/alvaromontoro/pen/BaaBYyz" target="_blank" rel="noopener">例子</a></p>
<hr>
<p><a href="https://css-tricks.com/are-there-random-numbers-in-css/" target="_blank" rel="noopener">参考</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/memory/2021/05/09/cssShapes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FoxDaxian">
      <meta itemprop="description" content="遇到好玩的，稀奇的，新鲜的，记录下来，分享出去。">
      <meta itemprop="image" content="/memory/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fox的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/memory/2021/05/09/cssShapes/" class="post-title-link" itemprop="url">css shapes</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2021-05-09 23:37:00" itemprop="dateCreated datePublished" datetime="2021-05-09T23:37:00+00:00">2021-05-09</time>
            </span>
          

          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/memory/categories/介绍/" itemprop="url" rel="index"><span itemprop="name">介绍</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>css shapes可以让css来生成一些几何图形，这种特性可以和float布局结合，让文字不再仅仅只能围绕在元素的矩形元素周围，还可以围绕在圆形、椭圆形、多边形甚至png图片内所示形状的元素盒子周围。<br><img src="https://foxdaxian.github.io/assets/03_css_shapes/cssshapes_featured-1.jpg" alt="12"><br>实现css shapes的主要属性是<code>shape-outside</code>，这个属性定义了文字可以围绕的一些几何形状。</p>
<p>常用的一些属性：</p>
<ul>
<li>circle(): 圆形</li>
<li>ellipse(): 椭圆形</li>
<li>inset(): 类似阴影的inset</li>
<li>olygon(): 自定义多边形</li>
</ul>
<p><strong>被应用的元素必须是float的，并且应该具有宽高属性</strong></p>
<p>具体细节请参考这篇文章：<a href="https://tympanus.net/codrops/2018/11/29/an-introduction-to-css-shapes/?utm_source=CSS-Weekly&utm_campaign=Issue-342&utm_medium=web" target="_blank" rel="noopener">参考链接</a></p>
<hr>
<p>附注：文中提及的<a href="https://chrome.google.com/webstore/detail/css-shapes-editor/nenndldnbcncjmeacmnondmkkfedmgmp?hl=en-US" target="_blank" rel="noopener">CSS Shapes Editor</a>的使用方法：</p>
<ol>
<li>随便https或者https协议服务网站</li>
<li>打开开发者工具</li>
<li>选择一个你想要的形状元素，选择<code>Styles</code>那一行的<code>shapes</code>的选项卡<br><img src="https://foxdaxian.github.io/assets/03_css_shapes/shapes_editor.png" alt="12"></li>
<li>点击<code>+</code>号，页面会出现编辑样式得虚线框和操作提示</li>
<li>进行拖拽，平移，旋转操作</li>
<li>被选中元素会出现ploygon相关属性，复制下来即可使用</li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/memory/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/memory/page/4/">4</a><a class="extend next" rel="next" href="/memory/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">FoxDaxian</p>
              <div class="site-description motion-element" itemprop="description">遇到好玩的，稀奇的，新鲜的，记录下来，分享出去。</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/memory/archives/">
                
                    <span class="site-state-item-count">40</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">11</span>
                    <span class="site-state-item-name">categories</span>
                  
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">4</span>
                    <span class="site-state-item-name">tags</span>
                  
                </div>
              
            </nav>
          

          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">FoxDaxian</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.2.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/memory/lib/jquery/index.js?v=3.4.1"></script>

  
  <script src="/memory/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/memory/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/memory/js/utils.js?v=7.2.0"></script>

  <script src="/memory/js/motion.js?v=7.2.0"></script>



  
  


  <script src="/memory/js/schemes/muse.js?v=7.2.0"></script>



  

  


  <script src="/memory/js/next-boot.js?v=7.2.0"></script>


  

  

  

  



  




  

  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
