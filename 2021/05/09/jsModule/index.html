<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">






















<link rel="stylesheet" href="/memory/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">

<link rel="stylesheet" href="/memory/css/main.css?v=7.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/memory/images/apple-touch-icon-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/memory/images/favicon-32x32-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/memory/images/favicon-16x16-next.png?v=7.2.0">


  <link rel="mask-icon" href="/memory/images/logo.svg?v=7.2.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/memory/',
    scheme: 'Muse',
    version: '7.2.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="我曾经做过js讲师，在我的任教过程中，模块系统一直是学生们的薄弱点。有一个充分的理由可以解释这个问题：模块在javascript中有一段奇怪且不稳定的历史。这篇文章我们将讨论这段历史，并且，你讲了解过去的模块的相关知识，以更好的理解当前模块的工作原理。在学习如何在js中创建模块之前，首先需要明白，模块是什么以及为什么会存在模块。环顾你的周边，你会发现，很多复杂的东西都是有一个个分离的部件组合在一起">
<meta name="keywords" content="frontend">
<meta property="og:type" content="article">
<meta property="og:title" content="js模块的前生今世">
<meta property="og:url" content="http://yoursite.com/2021/05/09/jsModule/index.html">
<meta property="og:site_name" content="fox的博客">
<meta property="og:description" content="我曾经做过js讲师，在我的任教过程中，模块系统一直是学生们的薄弱点。有一个充分的理由可以解释这个问题：模块在javascript中有一段奇怪且不稳定的历史。这篇文章我们将讨论这段历史，并且，你讲了解过去的模块的相关知识，以更好的理解当前模块的工作原理。在学习如何在js中创建模块之前，首先需要明白，模块是什么以及为什么会存在模块。环顾你的周边，你会发现，很多复杂的东西都是有一个个分离的部件组合在一起">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://raw.githubusercontent.com/FoxDaxian/FoxDaxian.github.io/master/assets/06_js_module/watch-internals.jpg">
<meta property="og:updated_time" content="2021-05-09T23:37:00.845Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="js模块的前生今世">
<meta name="twitter:description" content="我曾经做过js讲师，在我的任教过程中，模块系统一直是学生们的薄弱点。有一个充分的理由可以解释这个问题：模块在javascript中有一段奇怪且不稳定的历史。这篇文章我们将讨论这段历史，并且，你讲了解过去的模块的相关知识，以更好的理解当前模块的工作原理。在学习如何在js中创建模块之前，首先需要明白，模块是什么以及为什么会存在模块。环顾你的周边，你会发现，很多复杂的东西都是有一个个分离的部件组合在一起">
<meta name="twitter:image" content="https://raw.githubusercontent.com/FoxDaxian/FoxDaxian.github.io/master/assets/06_js_module/watch-internals.jpg">





  
  
  <link rel="canonical" href="http://yoursite.com/2021/05/09/jsModule/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>js模块的前生今世 | fox的博客</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/memory/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">fox的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">github地址 -> https://github.com/FoxDaxian</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
      
    

    

    <a href="/memory/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
      
    

    

    <a href="/memory/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/memory/2021/05/09/jsModule/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FoxDaxian">
      <meta itemprop="description" content="遇到好玩的，稀奇的，新鲜的，记录下来，分享出去。">
      <meta itemprop="image" content="/memory/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fox的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">js模块的前生今世

              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2021-05-09 23:37:00" itemprop="dateCreated datePublished" datetime="2021-05-09T23:37:00+00:00">2021-05-09</time>
            </span>
          

          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/memory/categories/原理/" itemprop="url" rel="index"><span itemprop="name">原理</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>我曾经做过js讲师，在我的任教过程中，模块系统一直是学生们的薄弱点。有一个充分的理由可以解释这个问题：<strong><em>模块在javascript中有一段奇怪且不稳定的历史</em></strong>。这篇文章我们将讨论这段历史，并且，你讲了解过去的模块的相关知识，以更好的理解当前模块的工作原理。<br>在学习如何在js中创建模块之前，首先需要明白，模块是什么以及为什么会存在模块。环顾你的周边，你会发现，很多复杂的东西都是有一个个分离的部件组合在一起构成，进而形成一个完整的东西。</p>
<p>以一只手表为例：</p>
<p><img src="https://raw.githubusercontent.com/FoxDaxian/FoxDaxian.github.io/master/assets/06_js_module/watch-internals.jpg" alt="手表结构"></p>
<p>可以看到，一只手表由成百上千的内部部件组成，每一个内部部件都有特定的功能和清晰地边界以方便与其他部件协作。把这些部件组合在一起，就组成了这只完整的手表。我不是一个手表制造业的专家，但是我因为这种方法的优点是非常直观的。</p>
<h4 id="可复用性"><a href="#可复用性" class="headerlink" title="可复用性"></a>可复用性</h4><p>如果你仔细的观察一些上图中的构造，你会发现有很多部件都是重复的。由于这种模块化为中心的设计，手表中的不同功能也可以用到相同的部件。这种可复用部件的能力简化的工作制造流程，并且提高的利润。</p>
<h4 id="可组合性"><a href="#可组合性" class="headerlink" title="可组合性"></a>可组合性</h4><p>这种设计是可组合性的非常直观的案例。通过制定每个部件清晰地边界，能够很好地组合每一个部件，以创造一个功能齐全的手表。</p>
<h4 id="可利用性（或许有更好的解释？）"><a href="#可利用性（或许有更好的解释？）" class="headerlink" title="可利用性（或许有更好的解释？）"></a>可利用性（或许有更好的解释？）</h4><p>设想一下制造过程，公司不会制造手表，他们只是将这些部件拼接起来以产出一只完整的手表。他们可以自己制作这些部件，也可以将这些部件外包给其他工厂，这不重要，重要的是这些部件组合在一起就是一只完整的手表，而这些部件来自于哪是无关紧要的。</p>
<h4 id="隔离性"><a href="#隔离性" class="headerlink" title="隔离性"></a>隔离性</h4><p>明白手表的整个系统是很困难的，因为它由很多小而复杂的，功能专一的部件组成，每个部件都可以单独考虑，构造和修复。这种隔离性允许人们单独工作，不会成为彼此的负担。并且，如果一个部件循环，仅仅需要更换这个部件看，而不是更换这只表。</p>
<h4 id="组织化"><a href="#组织化" class="headerlink" title="组织化"></a>组织化</h4><p>组织是每个独立的拥有清晰边界的部件为了与其他部件组合的副产品，伴随着模块化，自然就会出现这种情况。</p>
<p>随着手表这样的结构不断产出，我们可以越来越清晰地认识到模块化的好处，那么，如果我们换成软件领域呢？其实是一样的。就像手表的设计一样，软件也应该被设计，分割成不同的具有特定功能的部件，并且具有为了与其他部件组合的清晰边界。不过，在软件中，这种部件被叫做模<strong><em>模块</em></strong>。到现在为止，模块给我们的感觉可能与react组件和函数大相径庭。那模块到底包含什么呢？</p>
<p><em>每一个模块都具有三部分：依赖，代码内容还有导出。</em></p>
<h4 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h4><p>当一个模块需要其他模块的功能，它可以<figure class="highlight plain"><figcaption><span>react```模块，如果你想使用``` lodash```，你也只需要```impiort lodash```模块。</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### code</span><br><span class="line"></span><br><span class="line">确定好你的模块需要的依赖之后，你就可以开始编写这个模块</span><br><span class="line"></span><br><span class="line">#### exports</span><br><span class="line"></span><br><span class="line">```exports```是当前模块的```接口```，引入这个模块的开发者可以使用你导出的一切功能。</span><br><span class="line"></span><br><span class="line">说了这么多概念，下面让我们来点实际的代码。</span><br><span class="line"></span><br><span class="line">先来看一个react router的例子，方便起见，可以看一下react提供的[模块目录](https://github.com/ReactTraining/react-router/tree/master/packages/react-router/modules)，在react router中合理的利用模块，事实证明，在大多数情况下，他们直接映射react组件到模块，在react项目中分离组件是很有意义的，重新审查上面的手表结构，将部件换成组件同样有意义。</span><br><span class="line"></span><br><span class="line">来看一下```MemoryRouter```模块的代码，现在不要关心代码的含义，只需要集中在代码的结构上。</span><br><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">// imports</span><br><span class="line">import React from &apos;react&apos;;</span><br><span class="line">import &#123; createMemoryHistory &#125; from &apos;history&apos;;</span><br><span class="line">import Router from &apos;./Router&apos;;</span><br><span class="line"></span><br><span class="line">// code</span><br><span class="line">class MemoryRouter extends React.Component &#123;</span><br><span class="line">    history = createMemoryHistory(this.props);</span><br><span class="line">    </span><br><span class="line">    render() &#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;Router</span><br><span class="line">            history=&#123;this.history&#125;</span><br><span class="line">            children=&#123;this.props.children&#125;</span><br><span class="line">            /&gt;;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//exports</span><br><span class="line">export default MemoryRouter;</span><br></pre></td></tr></table></figure></p>
<p>你可以注意到这个模块的顶部定义了依赖，和一些使当前模块正产工作的必需的模块。接下来，可以看到一些代码。在这个例子中，创建了一个叫做MemoryRouter的新的react组件，最后，在底部定义了对外导出：MemoryRouter，也就是说，任何导入该模块的模块都会得到MemoryRouter这个组件。</p>
<p>现在，我们对软件中的模块有了一个浅显的认识，让我们回顾一些手表设计带来的好处，在相同设计的软件中有哪些可以可以直接应用。</p>
<h4 id="可复用性-1"><a href="#可复用性-1" class="headerlink" title="可复用性"></a>可复用性</h4><p>因为模块可以在任何需要它的地方<figure class="highlight plain"><figcaption><span>reacrt```、```lodash```还有```jquery```都是可以从npm上下载的npm包。</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 可组合性</span><br><span class="line"></span><br><span class="line">由于模块定义了导入和导出，所以很容易组合起来，不仅如此。一个软件好的设计应该是低耦合，模块增加了代码的灵活性。</span><br><span class="line"></span><br><span class="line">#### 可利用性</span><br><span class="line"></span><br><span class="line">npm上有世界上数量最多的免费模块，超过七十万个，如果你需要某个功能的包，就去npm上找吧。</span><br><span class="line"></span><br><span class="line">#### 隔离性</span><br><span class="line"></span><br><span class="line">这里使用手表的描述也是合适的。不在赘述。</span><br><span class="line"></span><br><span class="line">#### 组织化</span><br><span class="line"></span><br><span class="line">模块最大的好处也许是组织化了，模块带来的分离，正如你所见的，帮助你避免污染全局命名空间，减少命名冲突。</span><br><span class="line"></span><br><span class="line">-----</span><br><span class="line"></span><br><span class="line">现在你大概了解了模块的结构和优点。是时候正式构建模块了。对此我们的方法是非常有条理的。原因是之前提到的，javascript中的模块有非常奇怪的历史，即使有更新的方法在javascript中创建模块，你也会时不时的看到一些老的创建方式。如果模块从2018年开始，这个可能没有一点用处，也就是说，我们会回到2010年的```模块```时代。那时，angularjs刚刚发布，jquery还在大范围使用。大部分公司使用javascript去构建复杂的web应用，而管理这些复杂的工具就是--模块。</span><br><span class="line"></span><br><span class="line">创建模块的第一个想法可能就是用文件分离代码。</span><br><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">// users.js</span><br><span class="line">var users = [&apos;Tyler&apos;, &apos;Sarah&apos;, &apos;Dan&apos;];</span><br><span class="line"></span><br><span class="line">function getUsers() &#123;</span><br><span class="line">    return users;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// dom.js</span><br><span class="line">function addUserToDom(name) &#123;</span><br><span class="line">    var node = document.createElement(&apos;li&apos;);</span><br><span class="line">    var text = document.createTextNode(name);</span><br><span class="line">    node.appendChild(text);</span><br><span class="line">    </span><br><span class="line">    document.getElementById(&apos;users&apos;).appendChild(node);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">document.getElementById(&apos;submit&apos;)</span><br><span class="line">    .addEventListener(&apos;click&apos;, function() &#123;</span><br><span class="line">        var input = document.getElementById(&apos;input&apos;);</span><br><span class="line">        addUserToDom(input.value);</span><br><span class="line">        input.value = &apos;&apos;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">var users = window.getUsers();</span><br><span class="line">for (var i = 0; i &lt; users.length; i++) &#123;</span><br><span class="line">    addUserToDom(users[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Users<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Users<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"users"</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag">      <span class="attr">id</span>=<span class="string">"input"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">type</span>=<span class="string">"text"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">placeholder</span>=<span class="string">"New User"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">input</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"submit"</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"users.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"dom.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><a href="https://github.com/tylermcginnis/modules/tree/separate-files" target="_blank" rel="noopener">这里</a>查看全部源代码</p>
<p>ok，我们成功的将app分离成不同的功能文件，是不是意味着我们已经实现了模块？不，绝对没有。我们做的只不过是分离代码所在的位置。在js中，只有创建函数才能生成新的作用域。我们未在函数中生命的变量，全都在全局对象上。也就是说，你可以访问他们通过<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">那么，如果分享分离没有给我们提供模块的功能，那我们要怎么做呢？重复强调一下模块的优点:复用性、组合型、利用性、隔离性还有可组织性。js有没有原始的特性以供我们创造模块，以达到上面说的优点？常规函数？当你思考函数的特点，它的特点和模块优点相似。所以，接下来该怎么做呢？如果我们暴露一个对象来替代直接把整个app暴露在全局对象下，并且命名这个对象为```app```，我们可以吧所有我们app需要用到的方法，挂在在这个```app```对象下。这样会防止我们污染全局变量。我们可以在里面放置任何东西，这样对于其他应用来说依然是不可见得。</span><br><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">// users.js</span><br><span class="line">function usersWrapper () &#123;</span><br><span class="line">  var users = [&quot;Tyler&quot;, &quot;Sarah&quot;, &quot;Dan&quot;]</span><br><span class="line"></span><br><span class="line">  function getUsers() &#123;</span><br><span class="line">    return users</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  APP.getUsers = getUsers</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">usersWrapper()</span><br><span class="line"></span><br><span class="line">// dom.js</span><br><span class="line"></span><br><span class="line">function domWrapper() &#123;</span><br><span class="line">  function addUserToDOM(name) &#123;</span><br><span class="line">    const node = document.createElement(&quot;li&quot;)</span><br><span class="line">    const text = document.createTextNode(name)</span><br><span class="line">    node.appendChild(text)</span><br><span class="line"></span><br><span class="line">    document.getElementById(&quot;users&quot;)</span><br><span class="line">      .appendChild(node)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  document.getElementById(&quot;submit&quot;)</span><br><span class="line">    .addEventListener(&quot;click&quot;, function() &#123;</span><br><span class="line">      var input = document.getElementById(&quot;input&quot;)</span><br><span class="line">      addUserToDOM(input.value)</span><br><span class="line"></span><br><span class="line">      input.value = &quot;&quot;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  var users = APP.getUsers()</span><br><span class="line">  for (var i = 0; i &lt; users.length; i++) &#123;</span><br><span class="line">    addUserToDOM(users[i])</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">domWrapper()</span><br></pre></td></tr></table></figure></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Users<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Users<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"users"</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag">      <span class="attr">id</span>=<span class="string">"input"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">type</span>=<span class="string">"text"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">placeholder</span>=<span class="string">"New User"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">input</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"submit"</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"app.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"users.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"dom.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><a href="https://github.com/tylermcginnis/modules/tree/wrappers" target="_blank" rel="noopener">这里</a>查看全部源代码</p>
<p>现在你查看window对象，相比于，只有我们的<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">让我们更进一步。有没有办法可以丢弃包裹函数？我们只是定义了它们，然后立即调用。给他们一个全局命名的唯一原因就是我们之后可以立即调用它们。如果我们没有给他们全局命名，有没有办法直接直接调用没有名字（匿名）的函数。不卖关子了，当然有了，就是```Immediately Invoked Function Expression```，简写为```IIFE```。</span><br><span class="line"></span><br><span class="line">#### IIFE</span><br><span class="line"></span><br><span class="line">它看起来像下面这样：</span><br><span class="line">```javascript</span><br><span class="line">(function() &#123;</span><br><span class="line">    console.log(&apos;Pronounced IF-EE&apos;);</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure></p>
<p>注意，这仅仅是一个被小括号<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">```javascript</span><br><span class="line">(function() &#123;</span><br><span class="line">    console.log(&apos;Pronounced IF-EE&apos;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>然后，就像其他函数一样，为了调用函数，我们增加了一对小括号在函数而最后。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Pronounced IF-EE'</span>);</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<p>现在，为了放弃丑陋的包裹函数和干净的全局命名空间让我们来使用<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">// users.js</span><br><span class="line"></span><br><span class="line">(function () &#123;</span><br><span class="line">  var users = [&quot;Tyler&quot;, &quot;Sarah&quot;, &quot;Dan&quot;]</span><br><span class="line"></span><br><span class="line">  function getUsers() &#123;</span><br><span class="line">    return users</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  APP.getUsers = getUsers</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line">// dom.js</span><br><span class="line"></span><br><span class="line">(function () &#123;</span><br><span class="line">  function addUserToDOM(name) &#123;</span><br><span class="line">    const node = document.createElement(&quot;li&quot;)</span><br><span class="line">    const text = document.createTextNode(name)</span><br><span class="line">    node.appendChild(text)</span><br><span class="line"></span><br><span class="line">    document.getElementById(&quot;users&quot;)</span><br><span class="line">      .appendChild(node)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  document.getElementById(&quot;submit&quot;)</span><br><span class="line">    .addEventListener(&quot;click&quot;, function() &#123;</span><br><span class="line">      var input = document.getElementById(&quot;input&quot;)</span><br><span class="line">      addUserToDOM(input.value)</span><br><span class="line"></span><br><span class="line">      input.value = &quot;&quot;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  var users = APP.getUsers()</span><br><span class="line">  for (var i = 0; i &lt; users.length; i++) &#123;</span><br><span class="line">    addUserToDOM(users[i])</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure></p>
<p><a href="https://github.com/tylermcginnis/modules/tree/IIFEs" target="_blank" rel="noopener">这里</a>查看全部源代码</p>
<p>么么哒。现在你在查看window对象，你会发现，我们仅仅挂在了一个app对象在上面，他将作为全局方法的命名空间。</p>
<p>这就是IIFE模块模式。</p>
<p>IIFE模块模式有什么优点呢？首先，最重要的一点是，我们没有污染全局命名空间，这避免了变量冲突，并且提供代码私有性。有利就有弊，我们仍然有一个全局app变量，如果其他框架使用了相同的代码，我们就有麻烦了。第二点，你可能主要到了html文件中的script的顺序，如果顺序不对，那么app直接会挂掉。<br>不过，就算这不是最完美的。我们依然进步了一大块。我们知道了IIFE模块模式的优点和缺点。如果我们用我们的标准创建并管理模块，它有哪些特性呢？</p>
<p>早些时候，我们对模块分离的第一感觉每个文件都是一个新的模块。就算这种想法在js中不是开箱就用的。我认为对模块来说这是一个非常显著的分离。每个文件就是一个单独的模块，然后我们需要一个特性是每个文件（模块）都能定义自己的导入和导出。并可在其他文件（模块）中导入。</p>
<h4 id="我们的标准"><a href="#我们的标准" class="headerlink" title="我们的标准"></a>我们的标准</h4><ul>
<li>基于文件的模块</li>
<li>明确的导入</li>
<li>明确的导出</li>
</ul>
<p>现在，我们明确了我们想要的标准，让我们开始开发api。我们需要定义的看起来像是<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">var users = [&quot;Tyler&quot;, &quot;Sarah&quot;, &quot;Dan&quot;]</span><br><span class="line"></span><br><span class="line">function getUsers() &#123;</span><br><span class="line">  return users</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports.getUsers = getUsers</span><br></pre></td></tr></table></figure></p>
<p>也可以这样：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> users = [<span class="string">"Tyler"</span>, <span class="string">"Sarah"</span>, <span class="string">"Dan"</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUsers</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> users</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  getUsers: getUsers</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>不管有多少个方法，我们都可以添加到<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">// users.js</span><br><span class="line"></span><br><span class="line">var users = [&quot;Tyler&quot;, &quot;Sarah&quot;, &quot;Dan&quot;]</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">  getUsers: function () &#123;</span><br><span class="line">    return users</span><br><span class="line">  &#125;,</span><br><span class="line">  sortUsers: function () &#123;</span><br><span class="line">    return users.sort()</span><br><span class="line">  &#125;,</span><br><span class="line">  firstUser: function () &#123;</span><br><span class="line">    return users[0]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>好了，我们解决了如何从模块导出，接下来我们需要解决如何导入。同样一切从简，首先假设我们有一个叫做<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">var users = require(&apos;./users&apos;)</span><br><span class="line"></span><br><span class="line">users.getUsers() // [&quot;Tyler&quot;, &quot;Sarah&quot;, &quot;Dan&quot;]</span><br><span class="line">users.sortUsers() // [&quot;Dan&quot;, &quot;Sarah&quot;, &quot;Tyler&quot;]</span><br><span class="line">users.firstUser() // [&quot;Tyler&quot;]</span><br></pre></td></tr></table></figure></p>
<p>哦耶~ 利用假象的<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">看完这个标准，有没有灵光一现？这tm不就是commonjs吗？</span><br><span class="line"></span><br><span class="line">commonjs小组定义了模块模式去解决js作用域问题，以确保每个模块在他们自己的命名空间执行。通过模块明确导出那些变量来实现，通过其他模块定义的require来正确工作。</span><br><span class="line">如果你之前使用过node，conmonjs你会很熟悉。使用node，你可以开箱即用的使用require和module.exports语法，不过，浏览器并未支持。事实上，就算浏览器支持，浏览器也不会使用commonjs，因为它不是异步加载模块。众所周知，浏览器是单线程。异步才是王道。</span><br><span class="line">简单总结一下，commonjs有两个问题，首先浏览器不支持，第二，浏览器就算支持了也会因为commonjs的同步加载造成很糟糕的用户体验。如果我们能修复这两个问题，这也许是一个好的方案。不过，花费很多的时间去考虑研究commonjs是否对浏览器足够友好有没有意义呢？不管怎么样，这有一个新的解决方案，它叫做模块打包器。</span><br><span class="line"></span><br><span class="line">#### 模块打包器</span><br><span class="line"></span><br><span class="line">模块打包器的作用是检查你的代码库。寻找所有的imports和exports，然后解析打包成浏览器可以明白的代码到一个单独的新文件。而且你不再用小心翼翼的引入所有script，你应该直接引入打包好的那个文件。</span><br><span class="line"></span><br><span class="line">app.js ---&gt; | </span><br><span class="line">users.js -&gt; | Bundler | -&gt; bundle.js</span><br><span class="line">dom.js ---&gt; | </span><br><span class="line"></span><br><span class="line">所以，模块打包器到底做了什么捏？这个问题很大，我也不能全部解释清楚，不过，这有一个通过webpack打包之后的输出，你可以自己领悟领悟，哈哈。</span><br><span class="line"></span><br><span class="line">[这里](https://github.com/tylermcginnis/modules/tree/commonjs)查看所有源代码，你也可以下载下来，执行 npm install，然后执行webpack</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">(function(modules) &#123; // webpackBootstrap</span><br><span class="line">  // 模块缓存</span><br><span class="line">  var installedModules = &#123;&#125;;</span><br><span class="line">  // require函数</span><br><span class="line">  function __webpack_require__(moduleId) &#123;</span><br><span class="line">    // 检查module是否有缓存</span><br><span class="line">    if(installedModules[moduleId]) &#123;</span><br><span class="line">      return installedModules[moduleId].exports;</span><br><span class="line">    &#125;</span><br><span class="line">    // 创建一个module并缓存</span><br><span class="line">    var module = installedModules[moduleId] = &#123;</span><br><span class="line">      i: moduleId,</span><br><span class="line">      l: false,</span><br><span class="line">      exports: &#123;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    // 执行module</span><br><span class="line">    modules[moduleId].call(</span><br><span class="line">      module.exports,</span><br><span class="line">      module,</span><br><span class="line">      module.exports,</span><br><span class="line">      __webpack_require__</span><br><span class="line">    );</span><br><span class="line">    // 设置module为已load</span><br><span class="line">    module.l = true;</span><br><span class="line">    // 返回模块的导出</span><br><span class="line">    return module.exports;</span><br><span class="line">  &#125;</span><br><span class="line">  // 暴露模块对象</span><br><span class="line">  __webpack_require__.m = modules;</span><br><span class="line">  // 暴露模块缓存</span><br><span class="line">  __webpack_require__.c = installedModules;</span><br><span class="line">  // 定义getter函数</span><br><span class="line">  __webpack_require__.d = function(exports, name, getter) &#123;</span><br><span class="line">    if(!__webpack_require__.o(exports, name)) &#123;</span><br><span class="line">      Object.defineProperty(</span><br><span class="line">        exports,</span><br><span class="line">        name,</span><br><span class="line">        &#123; enumerable: true, get: getter &#125;</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  // 在导出中定义__esModule</span><br><span class="line">  __webpack_require__.r = function(exports) &#123;</span><br><span class="line">    if(typeof Symbol !== &apos;undefined&apos; &amp;&amp; Symbol.toStringTag) &#123;</span><br><span class="line">      Object.defineProperty(exports, Symbol.toStringTag, &#123; value: &apos;Module&apos; &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    Object.defineProperty(exports, &apos;__esModule&apos;, &#123; value: true &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  // 创建假的命名空间对象</span><br><span class="line">  // mode &amp; 1: value是模块id，通过它引入</span><br><span class="line">  // mode &amp; 2: 合并所有属性到ns对象上</span><br><span class="line">  // mode &amp; 4: ns已经存在时，直接返回</span><br><span class="line">  // mode &amp; 8|1: 行为和require一样</span><br><span class="line">  __webpack_require__.t = function(value, mode) &#123;</span><br><span class="line">    if(mode &amp; 1) value = __webpack_require__(value);</span><br><span class="line">    if(mode &amp; 8) return value;</span><br><span class="line">    if((mode &amp; 4) &amp;&amp; typeof value === &apos;object&apos; &amp;&amp; value &amp;&amp; value.__esModule) return value;</span><br><span class="line">    var ns = Object.create(null);</span><br><span class="line">    __webpack_require__.r(ns);</span><br><span class="line">    Object.defineProperty(ns, &apos;default&apos;, &#123; enumerable: true, value: value &#125;);</span><br><span class="line">    if(mode &amp; 2 &amp;&amp; typeof value != &apos;string&apos;)</span><br><span class="line">      for(var key in value)</span><br><span class="line">        __webpack_require__.d(ns, key, function(key) &#123;</span><br><span class="line">          return value[key];</span><br><span class="line">        &#125;.bind(null, key));</span><br><span class="line">    return ns;</span><br><span class="line">  &#125;;</span><br><span class="line">  // getDefaultExport function for compatibility with non-harmony modules</span><br><span class="line">  __webpack_require__.n = function(module) &#123;</span><br><span class="line">    var getter = module &amp;&amp; module.__esModule ?</span><br><span class="line">      function getDefault() &#123; return module[&apos;default&apos;]; &#125; :</span><br><span class="line">      function getModuleExports() &#123; return module; &#125;;</span><br><span class="line">    __webpack_require__.d(getter, &apos;a&apos;, getter);</span><br><span class="line">    return getter;</span><br><span class="line">  &#125;;</span><br><span class="line">  // Object.prototype.hasOwnProperty.call</span><br><span class="line">  __webpack_require__.o = function(object, property) &#123;</span><br><span class="line">      return Object.prototype.hasOwnProperty.call(object, property);</span><br><span class="line">  &#125;;</span><br><span class="line">  // __webpack_public_path__</span><br><span class="line">  __webpack_require__.p = &quot;&quot;;</span><br><span class="line">  // Load entry module and return exports</span><br><span class="line">  return __webpack_require__(__webpack_require__.s = &quot;./dom.js&quot;);</span><br><span class="line">&#125;)</span><br><span class="line">/************************************************************************/</span><br><span class="line">(&#123;</span><br><span class="line"></span><br><span class="line">/***/ &quot;./dom.js&quot;:</span><br><span class="line">/*!****************!*\</span><br><span class="line">  !*** ./dom.js ***!</span><br><span class="line">  \****************/</span><br><span class="line">/*! no static exports found */</span><br><span class="line">/***/ (function(module, exports, __webpack_require__) &#123;</span><br><span class="line"></span><br><span class="line">eval(`</span><br><span class="line">  var getUsers = __webpack_require__(/*! ./users */ \&quot;./users.js\&quot;).getUsers\n\n</span><br><span class="line">  function addUserToDOM(name) &#123;\n</span><br><span class="line">    const node = document.createElement(\&quot;li\&quot;)\n</span><br><span class="line">    const text = document.createTextNode(name)\n</span><br><span class="line">    node.appendChild(text)\n\n</span><br><span class="line">    document.getElementById(\&quot;users\&quot;)\n</span><br><span class="line">      .appendChild(node)\n&#125;\n\n</span><br><span class="line">    document.getElementById(\&quot;submit\&quot;)\n</span><br><span class="line">      .addEventListener(\&quot;click\&quot;, function() &#123;\n</span><br><span class="line">        var input = document.getElementById(\&quot;input\&quot;)\n</span><br><span class="line">        addUserToDOM(input.value)\n\n</span><br><span class="line">        input.value = \&quot;\&quot;\n&#125;)\n\n</span><br><span class="line">        var users = getUsers()\n</span><br><span class="line">        for (var i = 0; i &lt; users.length; i++) &#123;\n</span><br><span class="line">          addUserToDOM(users[i])\n</span><br><span class="line">        &#125;\n\n\n//# sourceURL=webpack:///./dom.js?`</span><br><span class="line">);&#125;),</span><br><span class="line"></span><br><span class="line">/***/ &quot;./users.js&quot;:</span><br><span class="line">/*!******************!*\</span><br><span class="line">  !*** ./users.js ***!</span><br><span class="line">  \******************/</span><br><span class="line">/*! no static exports found */</span><br><span class="line">/***/ (function(module, exports) &#123;</span><br><span class="line"></span><br><span class="line">eval(`</span><br><span class="line">  var users = [\&quot;Tyler\&quot;, \&quot;Sarah\&quot;, \&quot;Dan\&quot;]\n\n</span><br><span class="line">  function getUsers() &#123;\n</span><br><span class="line">    return users\n&#125;\n\nmodule.exports = &#123;\n</span><br><span class="line">      getUsers: getUsers\n</span><br><span class="line">    &#125;\n\n//# sourceURL=webpack:///./users.js?`);&#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>你可以注意到有很多奇奇怪怪的代码，你可以阅读注释来简单了解一下到底发生了什么。但是，一个很有趣的事是，打包后的代码用一个IIFE包裹起来了。也就是说，他们使用了IIFE模块模式得到了一个相对来说最完美的方案。</p>
<p>javascript的未来是一个活生生的，丰满的语言。TC-31标准委员会，一年内多次讨论如何潜在改善提高javascript语言。换言之，模块是编写可伸缩性、可维护的js代码的关键特性。在2013年甚至更早之前，这种说法很显然是不存在的。js需要一种模块的标准。一种内建的可处理模块的解决方法，这也拉开了实现js模块化的序幕。</p>
<p>如你现在所知道的。如果你之前接受过创建js系统模块的任务，这个模块最终看起来将是什么样的？commonjs？每个文件以一种很清晰的方式定义导入和导出，很显然，这个是重中之重。但是有个问题，commonjs加载模块是同步的。虽然这对服务端没有压力，但是对浏览器不是很友好。一个改变是让commonjs支持异步加载，另一种我们使用语言自己的模块化，也就是<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">这次，我们不需要再假想这种实现了，TC-39标准委员会提出了精确的设计和描述，也就是&quot;ES Modules&quot;。下面让我们以这种标准化的模块创建javascript模块。</span><br><span class="line"></span><br><span class="line">#### EM Modules</span><br><span class="line">正如上面所说的，为了指定你要导出的模块，你需要使用```export```关键字。</span><br><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">// utils.js</span><br><span class="line"></span><br><span class="line">// Not exported</span><br><span class="line">function once(fn, context) &#123;</span><br><span class="line">	var result</span><br><span class="line">	return function() &#123;</span><br><span class="line">		if(fn) &#123;</span><br><span class="line">			result = fn.apply(context || this, arguments)</span><br><span class="line">			fn = null</span><br><span class="line">		&#125;</span><br><span class="line">		return result</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Exported</span><br><span class="line">export function first (arr) &#123;</span><br><span class="line">  return arr[0]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Exported</span><br><span class="line">export function last (arr) &#123;</span><br><span class="line">  return arr[arr.length - 1]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>有几种方式可以导入<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">import * as utils from &apos;./utils&apos;</span><br><span class="line"></span><br><span class="line">utils.first([1,2,3]) // 1</span><br><span class="line">utils.last([1,2,3]) // 3</span><br></pre></td></tr></table></figure></p>
<p>如果我们不想导入全部导出呢？在这个例子中，如果你只想引入<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">import &#123; first &#125; from &apos;./utils&apos;</span><br><span class="line"></span><br><span class="line">first([1,2,3]) // 1</span><br></pre></td></tr></table></figure></p>
<p>还有呢，不仅仅可以指定多个导出，你还可以指定一个<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">// leftpad.js</span><br><span class="line"></span><br><span class="line">export default function leftpad (str, len, ch) &#123;</span><br><span class="line">  var pad = &apos;&apos;;</span><br><span class="line">  while (true) &#123;</span><br><span class="line">    if (len &amp; 1) pad += ch;</span><br><span class="line">    len &gt;&gt;= 1;</span><br><span class="line">    else break;</span><br><span class="line">  &#125;</span><br><span class="line">  return pad + str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>当你使用<figure class="highlight plain"><figcaption><span>name from './patn'```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">import leftpad from &apos;./leftpad&apos;</span><br></pre></td></tr></table></figure></p>
<p>现在，如果你有默认导出，也有其他格式的导出怎么办呢？这不是问题，按照正确的语法写就可以了，ES Module没有这种限制。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils.js</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">once</span>(<span class="params">fn, context</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> result</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(fn) &#123;</span><br><span class="line">			result = fn.apply(context || <span class="keyword">this</span>, <span class="built_in">arguments</span>)</span><br><span class="line">			fn = <span class="literal">null</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> result</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// regular export</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">first</span> (<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> arr[<span class="number">0</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// regular export</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">last</span> (<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> arr[arr.length - <span class="number">1</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// default export</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">leftpad</span> (<span class="params">str, len, ch</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> pad = <span class="string">''</span>;</span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (len &amp; <span class="number">1</span>) pad += ch;</span><br><span class="line">    len &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> pad + str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那导入语法看起来是什么样的？我觉得你可以想象得到。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> leftpad, &#123; first, last &#125; <span class="keyword">from</span> <span class="string">'./utils'</span></span><br></pre></td></tr></table></figure>

<p>还是挺爽的是吧？<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">ES Modules的关键点在于，它是js语言的一部分，并且现代浏览器已经支持这种写法了。现在，让我们回到一开始的app，不过这次我们使用ES Modules来改写一遍。</span><br><span class="line"></span><br><span class="line">[这里](https://github.com/tylermcginnis/modules/tree/esModules)查看所有源代码</span><br><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">// users.js</span><br><span class="line"></span><br><span class="line">var users = [&quot;Tyler&quot;, &quot;Sarah&quot;, &quot;Dan&quot;]</span><br><span class="line"></span><br><span class="line">export default function getUsers() &#123;</span><br><span class="line">  return users</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// dom.js</span><br><span class="line"></span><br><span class="line">import getUsers from &apos;./users.js&apos;</span><br><span class="line"></span><br><span class="line">function addUserToDOM(name) &#123;</span><br><span class="line">  const node = document.createElement(&quot;li&quot;)</span><br><span class="line">  const text = document.createTextNode(name)</span><br><span class="line">  node.appendChild(text)</span><br><span class="line"></span><br><span class="line">  document.getElementById(&quot;users&quot;)</span><br><span class="line">    .appendChild(node)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">document.getElementById(&quot;submit&quot;)</span><br><span class="line">  .addEventListener(&quot;click&quot;, function() &#123;</span><br><span class="line">    var input = document.getElementById(&quot;input&quot;)</span><br><span class="line">    addUserToDOM(input.value)</span><br><span class="line"></span><br><span class="line">    input.value = &quot;&quot;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">var users = getUsers()</span><br><span class="line">for (var i = 0; i &lt; users.length; i++) &#123;</span><br><span class="line">  addUserToDOM(users[i])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>使用IIFE模式，我们需要使用script引入每个js文件。使用commonjs，我们需要使用webpack等打包器处理我们的代码，然后引入打包后的文件。而ES Modules中，在一些现在浏览器中，我们仅仅需要使用script标签引入我们的未被处理过的入口文件，然后为script标签增加属性:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">```html</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;title&gt;Users&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line"></span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;h1&gt;Users&lt;/h1&gt;</span><br><span class="line">    &lt;ul id=&quot;users&quot;&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">    &lt;input id=&quot;input&quot; type=&quot;text&quot; placeholder=&quot;New User&quot;&gt;&lt;/input&gt;</span><br><span class="line">    &lt;button id=&quot;submit&quot;&gt;Submit&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">    &lt;script type=module src=&apos;dom.js&apos;&gt;&lt;/script&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<h4 id="死代码消除"><a href="#死代码消除" class="headerlink" title="死代码消除"></a>死代码消除</h4><p>到这里，还有一个commonjs与ES Modules的不同没有介绍。<br>commonjs中，你可以在任何地方引入模块，甚至通过判断。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (pastTheFold === <span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="built_in">require</span>(<span class="string">'./parallax'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ES Modules需要静态解析（参考js词法解析，也会有提升的效果）的，import语句必须在模块顶部，也就是说，他不能再判断语句中或者其他类似的语句中使用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (pastTheFold === <span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="keyword">import</span> <span class="string">'./parallax'</span> <span class="comment">// "import' and 'export' may only appear at the top level"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这是因为加载器会进行模块树的静态解析。找到那些真正被用到的，丢弃那些未被使用到的。这是一个很大的话题。换句话说，这也是为什么ES Modules希望你声明import语句在模块顶部，这样打包器会更快的解析的你依赖树，解析完毕，他才会去真正的工作。</p>
<p>对了，其实你可以使用<code>import()</code>来动态导入。请自行查找。</p>
<p>希望通过这篇文章可以帮到你。</p>
<p><a href="https://tylermcginnis.com/javascript-modules-iifes-commonjs-esmodules/" target="_blank" rel="noopener">原文链接</a></p>
<hr>
<ul>
<li>script标签上加上<code>type=&#39;module&#39;</code>的加载模式都是<code>defer</code>。</li>
<li>IIFE：匿名函数</li>
<li>AMD：依赖前置异步模块加载</li>
<li>CMD：就近依赖异步模块加载</li>
<li>commonjs(cjs)：服务端通用的模块加载</li>
<li>UMD：不是单独的标准，是IIFE、AMD(CMD)、commonjs的结合。</li>
<li>es：js自己的模块打包</li>
</ul>
<table>
<thead>
<tr>
<th>标准</th>
<th>变量问题</th>
<th>依赖</th>
<th>动态/懒 加载</th>
<th>静态分析</th>
</tr>
</thead>
<tbody><tr>
<td>IIFE</td>
<td>✔</td>
<td>×</td>
<td>×</td>
<td>×</td>
</tr>
<tr>
<td>AMD</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>×</td>
</tr>
<tr>
<td>CMD</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>×</td>
</tr>
<tr>
<td>commonjs</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>×</td>
</tr>
<tr>
<td>es6</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
</tr>
</tbody></table>
<p>再强调一点：es6的模块是值的引用，commonjs是值的拷贝。<a href="https://zhuanlan.zhihu.com/p/33843378" target="_blank" rel="noopener">参考文章</a></p>

      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        
          
        
        <div class="post-tags">
          
            <a href="/memory/tags/frontend/" rel="tag"># frontend</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/memory/2021/05/09/koaMiddles/" rel="next" title="koa 中间件原理">
                <i class="fa fa-chevron-left"></i> koa 中间件原理
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/memory/2021/05/09/httpReferer/" rel="prev" title="http referer">
                http referer <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">FoxDaxian</p>
              <div class="site-description motion-element" itemprop="description">遇到好玩的，稀奇的，新鲜的，记录下来，分享出去。</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/memory/archives/">
                
                    <span class="site-state-item-count">40</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">11</span>
                    <span class="site-state-item-name">categories</span>
                  
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">4</span>
                    <span class="site-state-item-name">tags</span>
                  
                </div>
              
            </nav>
          

          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#可复用性"><span class="nav-number">1.</span> <span class="nav-text">可复用性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#可组合性"><span class="nav-number">2.</span> <span class="nav-text">可组合性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#可利用性（或许有更好的解释？）"><span class="nav-number">3.</span> <span class="nav-text">可利用性（或许有更好的解释？）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#隔离性"><span class="nav-number">4.</span> <span class="nav-text">隔离性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#组织化"><span class="nav-number">5.</span> <span class="nav-text">组织化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#依赖"><span class="nav-number">6.</span> <span class="nav-text">依赖</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#可复用性-1"><span class="nav-number">7.</span> <span class="nav-text">可复用性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#我们的标准"><span class="nav-number">8.</span> <span class="nav-text">我们的标准</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#死代码消除"><span class="nav-number">9.</span> <span class="nav-text">死代码消除</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">FoxDaxian</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.2.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/memory/lib/jquery/index.js?v=3.4.1"></script>

  
  <script src="/memory/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/memory/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/memory/js/utils.js?v=7.2.0"></script>

  <script src="/memory/js/motion.js?v=7.2.0"></script>



  
  


  <script src="/memory/js/schemes/muse.js?v=7.2.0"></script>



  
  <script src="/memory/js/scrollspy.js?v=7.2.0"></script>
<script src="/memory/js/post-details.js?v=7.2.0"></script>



  


  <script src="/memory/js/next-boot.js?v=7.2.0"></script>


  

  

  

  


  


  




  

  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
